<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TAF2 OE AS analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="TAF2OE_AS_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="TAF2OE_AS_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="TAF2OE_AS_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="TAF2OE_AS_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TAF2OE_AS_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="TAF2OE_AS_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TAF2OE_AS_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="TAF2OE_AS_analysis_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="TAF2OE_AS_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TAF2OE_AS_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TAF2OE_AS_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="TAF2OE_AS_analysis_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro"><span class="toc-section-number">1</span>  Intro</a>
  <ul class="collapse">
  <li><a href="#fastq-files-processing" id="toc-fastq-files-processing" class="nav-link" data-scroll-target="#fastq-files-processing"><span class="toc-section-number">1.1</span>  FASTQ files processing</a>
  <ul class="collapse">
  <li><a href="#align" id="toc-align" class="nav-link" data-scroll-target="#align"><span class="toc-section-number">1.1.1</span>  align</a></li>
  <li><a href="#merge" id="toc-merge" class="nav-link" data-scroll-target="#merge"><span class="toc-section-number">1.1.2</span>  merge</a></li>
  <li><a href="#combine" id="toc-combine" class="nav-link" data-scroll-target="#combine"><span class="toc-section-number">1.1.3</span>  combine</a></li>
  <li><a href="#compare" id="toc-compare" class="nav-link" data-scroll-target="#compare"><span class="toc-section-number">1.1.4</span>  compare</a></li>
  <li><a href="#tidy" id="toc-tidy" class="nav-link" data-scroll-target="#tidy"><span class="toc-section-number">1.1.5</span>  tidy</a></li>
  <li><a href="#diff" id="toc-diff" class="nav-link" data-scroll-target="#diff"><span class="toc-section-number">1.1.6</span>  diff</a></li>
  </ul></li>
  <li><a href="#selecting-differentially-spliced-events" id="toc-selecting-differentially-spliced-events" class="nav-link" data-scroll-target="#selecting-differentially-spliced-events"><span class="toc-section-number">1.2</span>  Selecting differentially spliced events</a>
  <ul class="collapse">
  <li><a href="#effect-size-method" id="toc-effect-size-method" class="nav-link" data-scroll-target="#effect-size-method"><span class="toc-section-number">1.2.1</span>  Effect size method</a></li>
  <li><a href="#statistically-significant-method." id="toc-statistically-significant-method." class="nav-link" data-scroll-target="#statistically-significant-method."><span class="toc-section-number">1.2.2</span>  Statistically significant method.</a></li>
  <li><a href="#bayesian-inference-method" id="toc-bayesian-inference-method" class="nav-link" data-scroll-target="#bayesian-inference-method"><span class="toc-section-number">1.2.3</span>  Bayesian inference method</a></li>
  </ul></li>
  <li><a href="#quarto" id="toc-quarto" class="nav-link" data-scroll-target="#quarto"><span class="toc-section-number">1.3</span>  Quarto</a></li>
  </ul></li>
  <li><a href="#packages-functions-file-paths." id="toc-packages-functions-file-paths." class="nav-link" data-scroll-target="#packages-functions-file-paths."><span class="toc-section-number">2</span>  Packages, functions &amp; file paths.</a></li>
  <li><a href="#differential-splicing-analysis" id="toc-differential-splicing-analysis" class="nav-link" data-scroll-target="#differential-splicing-analysis"><span class="toc-section-number">3</span>  Differential splicing analysis</a>
  <ul class="collapse">
  <li><a href="#compare-1" id="toc-compare-1" class="nav-link" data-scroll-target="#compare-1"><span class="toc-section-number">3.1</span>  compare</a>
  <ul class="collapse">
  <li><a href="#events-coverage-qc" id="toc-events-coverage-qc" class="nav-link" data-scroll-target="#events-coverage-qc"><span class="toc-section-number">3.1.1</span>  Events coverage QC</a></li>
  <li><a href="#shared-and-specific-dses" id="toc-shared-and-specific-dses" class="nav-link" data-scroll-target="#shared-and-specific-dses"><span class="toc-section-number">3.1.2</span>  Shared and Specific DSEs</a></li>
  </ul></li>
  <li><a href="#statistical-method-from-tidy" id="toc-statistical-method-from-tidy" class="nav-link" data-scroll-target="#statistical-method-from-tidy"><span class="toc-section-number">3.2</span>  statistical method (from tidy)</a>
  <ul class="collapse">
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca"><span class="toc-section-number">3.2.1</span>  PCA</a></li>
  <li><a href="#heatmaps" id="toc-heatmaps" class="nav-link" data-scroll-target="#heatmaps"><span class="toc-section-number">3.2.2</span>  Heatmaps</a></li>
  <li><a href="#testing-for-significance" id="toc-testing-for-significance" class="nav-link" data-scroll-target="#testing-for-significance"><span class="toc-section-number">3.2.3</span>  Testing for significance</a></li>
  <li><a href="#volcano-plots" id="toc-volcano-plots" class="nav-link" data-scroll-target="#volcano-plots"><span class="toc-section-number">3.2.4</span>  Volcano plots</a></li>
  <li><a href="#appendix-with-wilcoxon-test" id="toc-appendix-with-wilcoxon-test" class="nav-link" data-scroll-target="#appendix-with-wilcoxon-test"><span class="toc-section-number">3.2.5</span>  Appendix with wilcoxon test</a></li>
  </ul></li>
  <li><a href="#bayesian-method-from-diff" id="toc-bayesian-method-from-diff" class="nav-link" data-scroll-target="#bayesian-method-from-diff"><span class="toc-section-number">3.3</span>  Bayesian method (from diff)</a></li>
  <li><a href="#integrate-all-events" id="toc-integrate-all-events" class="nav-link" data-scroll-target="#integrate-all-events"><span class="toc-section-number">3.4</span>  integrate all events</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info"><span class="toc-section-number">4</span>  Session Info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TAF2 OE AS analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Intro</h1>
<p>Alternative splicing (AS) events included in this analysis are:</p>
<ol type="1">
<li><p>alternatively spliced exons and microexons</p></li>
<li><p>alternative splice sites (acceptor at 3’ and donor at 5’)</p></li>
<li><p>intron retentions</p></li>
</ol>
<p>For each sample AS events were quantified using the percentage of sequence inclusion (PSI) metric, which is a number ranging from zero and 100, corresponding to full sequence skipping or full sequence inclusion in a transcript respectively. Constitutively spliced exons have a PSI of 100.</p>
<p>These documents reports the downstream AS analysis after processing the samples with VAST-TOOLS<span class="citation" data-cites="Tapial2017">(<a href="#ref-Tapial2017" role="doc-biblioref">Tapial et al. 2017</a>)</span> using the following steps:</p>
<section id="fastq-files-processing" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="fastq-files-processing"><span class="header-section-number">1.1</span> FASTQ files processing</h2>
<p><code>vast-tools</code><span class="citation" data-cites="Tapial2017">(<a href="#ref-Tapial2017" role="doc-biblioref">Tapial et al. 2017</a>)</span> was used to quantify both AS events PSI and gene expression as normalised TPMs using <code>limma::normalizeBetweenArrays</code> and cRPKMs per gene. The analysis was performed using <code>vast-tool</code> v2.5.1.</p>
<p>The raw FASTQ files were processed as following:</p>
<section id="align" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="align"><span class="header-section-number">1.1.1</span> align</h3>
<p><code>vast-tools</code> maps the RNA-seq reads to a predefined set of exon-exon junctions (EEJ). This set of EEJ is an “<em>enriched</em>” version of all ENSEMBL transcripts. This dataset was analysed using Homo sapiens assembly hg38, based on ENSEMBL v88. To do so <code>vast-tools align</code> first trims the reads to 50 nucleotides fragments with a sliding window define by <code>--stepSize</code> (usually 25 or 20 nt). The trimmed reads are aligned to the EEJ libraries using <code>bowtie v1.2</code>. The trimmed reads must have at least 8 nucleotides overlapping the splice site and be uniquely mapping to be considered for quantification.</p>
<p>The raw fastq files were processed with <code>vast-tools align</code> with options <code>--sp hg38</code>, <code>---IR_version 2</code>, <code>--stepSize 20</code>, and <code>--expr</code>. Reads strand detection is done automatically.</p>
</section>
<section id="merge" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="merge"><span class="header-section-number">1.1.2</span> merge</h3>
<p>To pool individual replicates to increase sequencing read depth the <code>vast-tools merge</code> module merges samples into a super sample. This is basically equivalent to concatenating FASTQ files with <code>cat</code> before running <code>align</code>. This helps prevent biases in AS events identification towards highly expressed genes. For this analysis the 3 individual replicates per condition were merged.</p>
</section>
<section id="combine" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="combine"><span class="header-section-number">1.1.3</span> combine</h3>
<p>To build the main output containing all detected AS events the <code>vast-tools combine</code> module takes intermediate output files and generate a table named as <code>*INCLUSION_LEVELS_FULL-*&lt;SPECIES_ASSEMBLY&gt;-&lt;SAMPLES_NUM&gt;-v251.tab</code>. This file contains an AS event on each row, the first 6 columns contain basic information about the event (e.g.&nbsp;gene name, length, and coordinates) followed by a column with the PSI and a quality score column for each sample. Further details about the comma separated quality scores can be found <a href="https://github.com/vastgroup/vast-tools#combine-output-format">here</a>. This step also generates a similar table gene expression counts expressed as cRPKM or TPM.</p>
<p>All individual replicates and the merged super samples were combined with <code>vast-tools combine</code> with options <code>--add_version</code>, <code>--TPM</code> and <code>--norm</code> for gene expression.</p>
</section>
<section id="compare" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="compare"><span class="header-section-number">1.1.4</span> compare</h3>
<p>To calculate the differential inclusion level (∆PSI) between samples the combined table was processed with <code>vast-tools compare</code> using the HeLa FRT samples as control (<code>-a</code>) and the following filtering parameters: <code>--min_dPSI 15</code>, <code>--min_range 0</code>, <code>--max_dPSI 5</code>, <code>--print_sets</code>, <code>--noB3</code>, <code>--p_IR</code>, <code>--print_dPSI</code>, and <code>--GO</code>. HeLa TAF2 OE and NLS-TAF2 ∆IDR OE were each compared to the control separately. The comparison was done using the 3 individual replicates per condition or by using only the merged super sample. This is denoted in the file names as <code>_uniq_</code> or <code>_mrgd_</code>.</p>
</section>
<section id="tidy" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="tidy"><span class="header-section-number">1.1.5</span> tidy</h3>
<p>To simplify and filter the full inclusion table the module <code>vast-tools tidy</code> produces a table with only events that have a minimum coverage that are more likely to relevant for downstream analysis.</p>
<p>Full inclusion table was filtered using <code>vast-tools tidy</code> with <code>--noVLOW</code>,<code>--noB3</code>, <code>--p_IR</code>, and <code>--add_names</code>.</p>
</section>
<section id="diff" class="level3" data-number="1.1.6">
<h3 data-number="1.1.6" class="anchored" data-anchor-id="diff"><span class="header-section-number">1.1.6</span> diff</h3>
<p>Lastly, a different differential splicing analysis was performed with <code>vast-tools diff</code> using Bayesian inference. Briefly , it calculates PSI posterior distributions using Bayes’ theorem and employs replicates to estimate joint posterior distributions. The statistical significance between two posterior distributions is determined by comparing their differences using empirical distributions <span class="citation" data-cites="Han2017a">(<a href="#ref-Han2017a" role="doc-biblioref">Han et al. 2017</a>)</span> <span class="citation" data-cites="Weatheritt2016">(<a href="#ref-Weatheritt2016" role="doc-biblioref">Weatheritt, Sterne-Weiler, and Blencowe 2016</a>)</span>.</p>
<p>More specifically, the module <code>diff</code> uses:</p>
<ol type="1">
<li><p>A uniform prior distribution Beta(α = 1, β = 1).</p></li>
<li><p>A binomial likelihood function for the number of inclusion reads K ~ Binomial(Ψ, N).</p></li>
</ol>
<p>where Ψ represents PSI for any AS event and N is the total number of junction reads per event. The formula K ~ Binomial(Ψ, N) means that the number of inclusion reads (K) is assumed to follow a binomial distribution with Ψ as the probability of inclusion (i.e., success) and N as the total number of junction reads per splicing event.</p>
<p>This prior distribution represents our initial beliefs about the PSI before observing any data, while the likelihood function represents the probability of observing the data given a specific PSI value. The likelihood function follows a binomial distribution, which is appropriate for count data like the number of inclusion reads.</p>
<p>According to Bayes’ theorem, our prior beliefs about PSI are updated based on observed data to obtain the posterior distribution. In this case, the prior distribution (uniform Beta) and the likelihood function (binomial) are “<em>conjugate</em>” to each other, which means that the posterior distribution can be expressed in a closed form using the same type of distribution as the prior. Therefore the posterior distribution over Ψ, is represented as a Beta distribution with parameters Ψ ≈ Beta(K + α, (N – K) + β).</p>
<p>If replicates are available, joint posterior distributions for a sample are estimated from sampling empirical posterior distributions of the replicates and fitting a new posterior Beta with maximum likelihood estimation (MLE) using the <code>MASS::fitdist</code> function in <code>R</code>. This basically means combining the information from multiple replicates to get a more robust estimate of the PSI. The statistical significance between two biological conditions, defined as the level of confidence in determining whether two posterior PSI distributions are significantly different from each other, modelled as two posterior distributions X ~Beta, and Y ~Beta, is calculated as P(X – Y &gt; 0), i.e., X is higher than Y. This probability can be estimated from the difference of empirical distributions sampled between X and Y such that P(X – Y &gt; 0) =<span class="math inline">\(\sum_{i=1}^{n} (Xi –Yi &gt; 0) / N\)</span>. Lastly, significantly differential events were additionally required to have a PSI difference &gt; 10.</p>
<p>The <code>vast-tools diff</code> module was run with options: <code>-n 10000</code> (lines to process in parallel), <code>-m 0.15</code> (min ∆PSI/100) <code>-e 10</code> (minimum reads), <code>-z 16</code> (random seed), and <code>--noPDF</code> (do not plot the estimates).</p>
</section>
</section>
<section id="selecting-differentially-spliced-events" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="selecting-differentially-spliced-events"><span class="header-section-number">1.2</span> Selecting differentially spliced events</h2>
<p>I use 3 different methods to select differentially spliced events (DSEs).</p>
<section id="effect-size-method" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="effect-size-method"><span class="header-section-number">1.2.1</span> Effect size method</h3>
<p>Using the <code>compare</code> module pre-filters the events based on read coverage, imbalance and other features, and simply compares average and individual ∆PSIs. Between control and test samples the PSI distribution must be non overlapping, i.e.&nbsp;at least 10 PSI difference between the maximum and minimum PSI of the 2 groups (<code>--min_range 10</code>).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>compare</code> is a non-statistical approach</p>
</div>
</div>
<p>Differentially spliced events have a minimum |∆PSI| &gt;= 15. This might have the caveat of missing AS events in lowly expressed genes.</p>
</section>
<section id="statistically-significant-method." class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="statistically-significant-method."><span class="header-section-number">1.2.2</span> Statistically significant method.</h3>
<p>Using the filtered inclusion table generated with the <code>tidy</code> module events were further filtered to have a minimum of 2 samples per condition with coverage, a standard deviation of PSI between replicates below XYZ. Significance was calculate using a Mann-Whitney test followed by multiple hypothesis testing (BH) correction using <code>rstatix::wlcox_test</code> in <code>R</code>. Events with a <em>P</em>-value &lt;= 0.1 and a |∆PSI| &gt;= 7 were considered significant.</p>
</section>
<section id="bayesian-inference-method" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="bayesian-inference-method"><span class="header-section-number">1.2.3</span> Bayesian inference method</h3>
<p>Using the <code>diff</code> module of vast-tools filter for events with a Minimum Value (MV) of |∆PSI| at 95% confidence &gt;= 15%. This means that each event as a 95% probability to have a |∆PSI| between the 2 conditions higher or equal the MV.</p>
</section>
</section>
<section id="quarto" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="quarto"><span class="header-section-number">1.3</span> Quarto</h2>
<p>This document is generated using Quarto which enables to weave together content and executable code into a finished document. To learn more about Quarto see <a href="https://quarto.org">here</a>.</p>
</section>
</section>
<section id="packages-functions-file-paths." class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Packages, functions &amp; file paths.</h1>
<p>Load common packages that have to be pre-installed. Check <span class="citation" data-cites="session-info">(<a href="#ref-session-info" role="doc-biblioref"><strong>session-info?</strong></a>)</span> for package versions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UpSetR)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Cairo)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crayon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In addition I developed an <code>R</code> package called <code>niar</code> to stream line some of the common analysis steps. It can be installed from <a href="https://github.com/Ni-Ar/niar">my GitHub repository</a> using:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"Ni-Ar/niar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here I load the package from my local repository with:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="at">path =</span> <span class="st">'~/mnt/narecco/software/R/niar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Colour palettes</em>: Events coverage quality score colour palette.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>quality_score_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'#ffffcc'</span>, <span class="st">'#c2e699'</span>, <span class="st">'#78c679'</span>, <span class="st">'#31a354'</span>, <span class="st">'#006837'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>quality_score_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"VLOW"</span>, <span class="st">"LOW"</span>, <span class="st">"OK"</span>, <span class="st">"SOK"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(quality_score_colors) <span class="ot">&lt;-</span> quality_score_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Some generic functions I wrote for this analysis</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Group differentially spliced exons and introns</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data A data frame with the columns `dPSI`, `COMPLEX`, `comparison`</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A ggplot</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>plot_dPSI_hist_grpd <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  exon_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"ANN"</span>, <span class="st">"MIC"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  intron_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"IR"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  alt_ss <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alt3"</span>, <span class="st">"Alt5"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(dPSI, COMPLEX, comparison) <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(COMPLEX <span class="sc">%in%</span> exon_type <span class="sc">~</span> <span class="st">'Exon'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                            COMPLEX <span class="sc">%in%</span> intron_type <span class="sc">~</span> <span class="st">'Intron'</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                            COMPLEX <span class="sc">%in%</span> alt_ss <span class="sc">~</span> <span class="st">'alt. splice site'</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                            ) ) <span class="sc">|&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="sc">!</span> COMPLEX <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Alt3'</span>, <span class="st">'Alt5'</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> dPSI, <span class="at">fill =</span> dPSI <span class="sc">&gt;</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(TYPE <span class="sc">~</span> comparison, <span class="at">scales =</span> <span class="st">'free_x'</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">comparison =</span> <span class="fu">c</span>(<span class="at">TAF2dIDR =</span> <span class="st">'NLS-TAF2 ∆IDR'</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">TAF2 =</span> <span class="st">'TAF2'</span>) ) ) <span class="sc">+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">4</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>))) <span class="sc">+</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"firebrick3"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"dodgerblue3"</span>)) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u0394PSI (OE - Cntrl)"</span>, <span class="at">y =</span> <span class="st">"Num. of events"</span>) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>, <span class="at">base_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>, </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'gray84'</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>),</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>), </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background =</span> <span class="fu">element_blank</span>() ) <span class="ot">-&gt;</span> cmpr_dPSI_Hist</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cmpr_dPSI_Hist)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Show the number of events by quality score in a stacked bar plot</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data A dataframe with the complex `COMPLE` and `Quality_Score_Value`</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A ggplot</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plot_quality_score_stacked <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> COMPLEX, <span class="at">fill =</span> Quality_Score_Value) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> quality_score_colors, <span class="at">name =</span> <span class="st">"Score"</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>, <span class="at">add =</span> <span class="dv">1</span>), <span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Type of AS event'</span>, <span class="at">y =</span> <span class="st">'Number of AS event'</span>) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>, <span class="at">base_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="fl">0.95</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="at">units =</span> <span class="st">'mm'</span>), </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.direction =</span> <span class="st">'horizontal'</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">'grey84'</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>)) <span class="ot">-&gt;</span> cmpr_Scores_Bars</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cmpr_Scores_Bars)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plot_PSI_boxplot <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">num_col =</span> <span class="dv">5</span>, <span class="at">order_by_dPSI =</span> T) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (order_by_dPSI) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">EVENT =</span> <span class="fu">fct_reorder</span>(EVENT, dPSI)) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    gene_order <span class="ot">&lt;-</span> <span class="fu">unique</span>( df[<span class="fu">order</span>(df<span class="sc">$</span>EVENT, <span class="at">decreasing =</span> T), ]<span class="sc">$</span>GENE)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">GENE =</span> <span class="fu">factor</span>(GENE, <span class="at">levels =</span> gene_order))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> OE, <span class="at">y =</span> PSI) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>( <span class="sc">~</span> GENE <span class="sc">+</span> EVENT, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> num_col) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Quality_Score_Value, <span class="at">shape =</span> Replicate),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">stroke =</span> <span class="fl">0.2</span>, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Merge'</span> <span class="ot">=</span> <span class="dv">22</span>, <span class="st">'A'</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">'B'</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">'C'</span> <span class="ot">=</span> <span class="dv">21</span>)) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> quality_score_colors, <span class="at">name =</span> <span class="st">"Quality</span><span class="sc">\n</span><span class="st">Score"</span>) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">'FRT'</span> <span class="ot">=</span> <span class="st">'Cntrl'</span>, <span class="st">'TAF2'</span> <span class="ot">=</span> <span class="st">'TAF2'</span>, <span class="st">'NLSTAF2dIDR'</span> <span class="ot">=</span> <span class="st">'TAF2∆IDR'</span>) ) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>), </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>, <span class="at">add =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>)),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'PSI'</span>) <span class="sc">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">lineheight =</span> <span class="dv">0</span>, </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">unit =</span> <span class="st">'mm'</span>)),</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'gray84'</span>, <span class="at">linewidth =</span> <span class="fl">0.15</span>),</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.1</span>) ) </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate z score on a numeric matrix</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>zScore <span class="ot">&lt;-</span> <span class="cf">function</span>(mat) {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  row_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(mat, <span class="dv">1</span>, mean)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  row_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(mat, <span class="dv">1</span>, sd)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  zScore_mat <span class="ot">&lt;-</span> (mat <span class="sc">-</span> row_means) <span class="sc">/</span> row_sd</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(zScore_mat)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Files and directories paths</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>proj_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">'~/mnt/narecco/projects/01_ALTdemix'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>expr_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(proj_dir, <span class="st">'data/INCLUSION_tbl/Tanja'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>vast_out <span class="ot">&lt;-</span> <span class="fu">file.path</span>(expr_dir, <span class="st">'vast_tools/vast_out'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>psi_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(vast_out, <span class="st">'INCLUSION_LEVELS_FULL-hg38-12-v251.tab'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>expr_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(vast_out, <span class="st">'TPM-hg38-12-NORM.tab'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>cmpr_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(vast_out, <span class="st">'compare_2023_08_01/min_dPSI15_min_range0_max_dPSI5'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2_uniq_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cmpr_dir, <span class="st">'HeLa_TAF2OE_vs_CNTRL_uniq_noB3_pIR.tab'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2dIDR_uniq_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cmpr_dir, <span class="st">'HeLa_NLSTAF2dIDR_vs_CNTRL_uniq_noB3_pIR.tab'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2_mrgd_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cmpr_dir, <span class="st">'HeLa_TAF2OE_vs_CNTRL_mrgd_noB3_pIR.tab'</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2dIDR_mrgd_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cmpr_dir, <span class="st">'HeLa_NLSTAF2dIDR_vs_CNTRL_mrgd_noB3_pIR.tab'</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>tidy_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(vast_out, <span class="st">'tidy_2023_06_20'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>tidy_psi_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(tidy_dir, <span class="st">'INCLUSION_LEVELS_TIDY_HeLa_noVLOW_noB3_pIR.tab'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>diff_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(vast_out, <span class="st">'diff_2023_06_20/min_dPSI_min_reads10'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>diff_TAF2_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(diff_dir, <span class="st">'Fltrd_15_HeLa_TAF2OE_minRead10_noB3_pIR.tab'</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>diff_TAF2dIDR_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(diff_dir, <span class="st">'Fltrd_15_HeLa_NLSTAF2dIDR_minRead10_noB3_pIR.tab'</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>plot_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(expr_dir, <span class="st">'plots'</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ( <span class="sc">!</span><span class="fu">dir.exists</span>(plot_dir) ) { <span class="fu">dir.create</span>(<span class="at">path =</span> plot_dir, <span class="at">recursive =</span> T) }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="differential-splicing-analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Differential splicing analysis</h1>
<section id="compare-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="compare-1"><span class="header-section-number">3.1</span> compare</h2>
<p>Import the all the tables from the <code>vast-tools compare</code> analysis in a list</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">list.files</span>(cmpr_dir, <span class="at">full.names =</span> T, <span class="at">pattern =</span> <span class="st">'^HeLa_.*_noB3_pIR.tab$'</span>), <span class="cf">function</span>(x) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_vst_tbl</span>(<span class="at">path =</span> x, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy_vst_psi</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">'_noB3_pIR.tab'</span>, <span class="at">replacement =</span> <span class="st">''</span>, x) ) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">'</span><span class="sc">\\</span><span class="st">/Users*.*dPSI5</span><span class="sc">\\</span><span class="st">/'</span>, <span class="at">replacement =</span> <span class="st">''</span>, comparison) ) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"HeLa_"</span>, <span class="at">replacement =</span> <span class="st">''</span>, comparison )) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"vs_CNTRL_"</span>, <span class="at">replacement =</span> <span class="st">''</span>, comparison ))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> list_compares</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bind the list of dataframes into one single dataframe.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cmpr_events <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'rbind'</span>, list_compares) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Create a metadata from the samples’ names.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cmpr_events <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(comparison <span class="sc">==</span> <span class="st">'TAF2OE_uniq'</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CellType =</span> <span class="fu">str_split_fixed</span>(<span class="at">string =</span> Sample, <span class="at">pattern =</span> <span class="st">"_"</span>, <span class="at">n =</span> <span class="dv">3</span>)[,<span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OE =</span> <span class="fu">str_split_fixed</span>(<span class="at">string =</span> Sample, <span class="at">pattern =</span> <span class="st">"_"</span>, <span class="at">n =</span> <span class="dv">3</span>)[,<span class="dv">2</span>]) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Replicate =</span> <span class="fu">str_split_fixed</span>(<span class="at">string =</span> Sample, <span class="at">pattern =</span> <span class="st">"_"</span>, <span class="at">n =</span> <span class="dv">3</span>)[,<span class="dv">3</span>]) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Replicate =</span> <span class="fu">ifelse</span>(Replicate <span class="sc">==</span> <span class="st">''</span>, <span class="at">yes =</span> <span class="st">'Merge'</span>, <span class="at">no =</span> Replicate )) <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PrettySample =</span> <span class="fu">str_remove</span>(<span class="at">string =</span> Sample, <span class="at">pattern =</span> <span class="st">'HeLa_'</span>) ) <span class="ot">-&gt;</span> mtdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add metadata info to the compared events table.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cmpr_events <span class="ot">&lt;-</span> cmpr_events <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="events-coverage-qc" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="events-coverage-qc"><span class="header-section-number">3.1.1</span> Events coverage QC</h3>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Not all AS events are easily measurable and not all events have the same sequencing coverage.</p>
</div>
</div>
<p>The AS events quantified by <code>vast-tools</code> are divided in different subgroups based on their complexity, which is defined in the 6th column (<code>COMPLEX</code>) of the compare table. This complexity resemble the underlying exon-intron structures in the gene body.</p>
<p>Namely:</p>
<ul>
<li><code>S</code>, <code>C1</code>, <code>C2</code>, <code>C3</code> are types of exon skipping events quantified by the splice site-based or transcript-based modules, with increasing degrees of complexity (e.g.&nbsp;<code>S</code> = simple; <code>C3</code> more complex than <code>C2</code>). The complexity of an AS exon is based on <em>Score 5</em> from the quality column of the inclusion table and is based on the number of reads that come from the “reference” C1-A, A-C2 and C1-C2 junctions for a wide panel of RNA-seq samples (see Irimia et al.&nbsp;2014 for further information).</li>
<li><code>ANN</code> are exon skipping events quantified by the ANNOTATION module. Their IDs start by ≥ 6 (e.g.&nbsp;HsaEX6000001). These are exons from the reference GTF annotation used to build VAST-TOOLS. However, some annotated events are not present, because of low mappability or reads imbalance. In addition, the first and last exons are excluded.</li>
<li><code>MIC</code> are exon skipping events quantified by the microexon pipeline.</li>
<li><code>IR</code> are intron retention event.</li>
<li><code>Alt3</code> are alternative acceptor events at the 3’ splice site of an exon.</li>
<li><code>Alt5</code> are alternative donor events at the 5’ splice site of an exon.</li>
</ul>
<p>In addition, an AS event can be measured at different sequencing depths. In <code>vast-tool</code> this is resembled by the <em>Score 1</em> of from the quality column. Each event in each samples is given a score based on the actual read counts, before mappability correction. This coverage scores are: <code>N</code>, <code>VLOW</code>, <code>LOW</code>, <code>OK</code>, and <code>SOK</code>, (where <code>N</code> = not meeting minimum threshold, <code>V</code> = very and <code>S</code> = super). In general anything above <code>N</code> can be considered reliable and worth considering, but <code>VLOW</code> events might have an actual different PSI value if confirmed experimentally.</p>
<p>Here I check if the quality score of the events changes when including or excluding the super sample.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cmpr_events) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Quality_Score_Value, <span class="at">fill =</span> comparison) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>COMPLEX)  <span class="sc">+</span>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">width =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'orange'</span>, <span class="st">'firebrick'</span>, <span class="st">'lightblue3'</span>, <span class="st">'blue'</span>), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">'compared against control'</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), <span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'AS event quantification quality score'</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Number of samples with a certain quality score per AS event'</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">units =</span> <span class="st">'mm'</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">unit =</span> <span class="st">'mm'</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'gray84'</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">'black'</span>)) <span class="ot">-&gt;</span> p_QC_events_by_type</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>p_QC_events_by_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/check%20the%20number%20of%20events%20by%20quality%20score-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>As one can see there’s a gain in lower quality events if including the merged replicates super samples. This behaviour is kind of expected.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'01_QC_AS_Events_by_Type_Coverage_Barplot.pdf'</span>, <span class="at">plot =</span> p_QC_events_by_type, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">13.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When filtering out for <code>N</code> events…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fltrd_cmpr_events <span class="ot">&lt;-</span> <span class="fu">subset</span>(cmpr_events, <span class="fu">as.integer</span>(Quality_Score_Value) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>…and repeating the plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fltrd_cmpr_events) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Quality_Score_Value, <span class="at">fill =</span> comparison) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>COMPLEX)  <span class="sc">+</span>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">width =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'orange'</span>, <span class="st">'firebrick'</span>, <span class="st">'lightblue3'</span>, <span class="st">'blue'</span>), </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">'compared against control'</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), <span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'AS event quantification quality score'</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Number of samples with a certain quality score per AS event'</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">units =</span> <span class="st">'mm'</span>),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">unit =</span> <span class="st">'mm'</span>),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'gray84'</span>),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">'black'</span>)) <span class="ot">-&gt;</span> p_fltrd_QC_events_by_type</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>p_fltrd_QC_events_by_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/QC%20plot%20after%20compare%20filtering-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>One can see that the number DSEs drops and that again only the <code>mrgd</code> super samples, show more events for very low coverage events (<code>VLOW</code>). However for high coverage events (<code>SOK</code>) the number of DSEs doesn’t drastically change if using 3 replicates comparisons (<code>uniq</code>) or the merged comparison (<code>mrgd</code>). Interesting to see the gain in high quality IR with the TAF2 OE specifically. Also there are basically no microexon events differentially spliced.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'02_QC_AS_Events_by_Type_Filtered_by_Coverage_Barplot.pdf'</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> p_fltrd_QC_events_by_type, <span class="at">device =</span> cairo_pdf, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="fl">13.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="shared-and-specific-dses" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="shared-and-specific-dses"><span class="header-section-number">3.1.2</span> Shared and Specific DSEs</h3>
<p><strong>How many of this events overlap between the different comparisons?</strong></p>
<p>Make a list with all the differentially spliced events from each comparison, again filtering out the <code>N</code> events.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the filtered events</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>( list_compares, <span class="cf">function</span>(x){</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(x, <span class="fu">as.integer</span>(Quality_Score_Value) <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GENE, EVENT, comparison) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> diff_events_li</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># find events that are mis-spliced in all 4 comparisons</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>all_common_DSE_ids <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(diff_events_li, <span class="cf">function</span>(x) x<span class="sc">$</span>EVENT ) )</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get comparisons names</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>comparisons <span class="ot">&lt;-</span> <span class="fu">lapply</span>( list_compares, <span class="cf">function</span>(x){ <span class="fu">pull</span>(x, comparison) <span class="sc">|&gt;</span> <span class="fu">unique</span>() }) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># get events in each comparison</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>events_li <span class="ot">&lt;-</span> <span class="fu">lapply</span>( list_compares, <span class="cf">function</span>(x){ </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(x, <span class="fu">as.integer</span>(Quality_Score_Value) <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(EVENT) <span class="sc">|&gt;</span> <span class="fu">unique</span>() </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>}) </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(events_li) <span class="ot">&lt;-</span> comparisons</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(events_li, head, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$NLSTAF2dIDR_mrgd
[1] "HsaEX1037317" "HsaEX0014558" "HsaEX0036972"

$NLSTAF2dIDR_uniq
[1] "HsaEX0004676" "HsaEX0021749" "HsaEX0026581"

$TAF2OE_mrgd
[1] "HsaEX0044934" "HsaEX0003358" "HsaEX0031099"

$TAF2OE_uniq
[1] "HsaEX0003358" "HsaEX0053616" "HsaEX0045901"</code></pre>
</div>
</div>
<p>To show how many AS events are differentially spliced in each condition taking into consideration the replicates or the super sample, calculate the intersections between all 4 comparisons.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>intersection_cmpr_plt <span class="ot">&lt;-</span> <span class="fu">upset</span>(<span class="fu">fromList</span>(events_li), <span class="at">nsets =</span> <span class="fu">length</span>(comparisons),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">text.scale =</span> <span class="fl">1.5</span>, <span class="at">nintersects =</span> <span class="cn">NA</span>, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mb.ratio =</span> <span class="fu">c</span>(<span class="fl">0.65</span>, <span class="fl">0.35</span>), <span class="at">decreasing =</span> <span class="fu">c</span>(T, F),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">order.by =</span> <span class="st">'freq'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">main.bar.color =</span> <span class="st">"gray16"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Show the overlap as an upset plot:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>intersection_cmpr_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/show%20upset%20plot%20all-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>The plot above shows all possible intersections between the 4 groups.</p>
<p>Because the super samples (defined with <code>_mrg_</code>) are the sum of all the 3 individual replicates, they have more coverage and can better quantify exon-exon-junction reads. This explains the increased in number of DSEs. TAF2 OE and NLS-TAF2∆IDR super samples have more or less the same number of unique DSE, 1045 and 1008 DSEs respectively. Of these 311 DSEs are shared between the 2 over-expressions in the super sample comparison.</p>
<p>There are 66 DSEs shared between the TAF2 OE super samples and the comparison done only with 3 replicates and 66 DSEs shared between NLS-TAF2OE∆IDR super samples and the 3 replicates of this condition.</p>
<p>Save the upset plot to pdf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="at">file =</span> <span class="fu">file.path</span>(plot_dir, <span class="st">'03_overlap_fltrd_compare_DSE_Upset.pdf'</span>), <span class="at">width =</span> <span class="fl">5.5</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">height =</span> <span class="dv">5</span>, <span class="at">bg =</span> <span class="cn">NA</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>intersection_cmpr_plt</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
</div>
<p>Separate the parts of the dataframe with the <code>uniq</code> and <code>mrgd</code> comparisons, this is going to be useful when looking at the ∆PSI. Also rename the names of the comparisons.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cmpr_events_uniq <span class="ot">&lt;-</span> <span class="fu">subset</span>(fltrd_cmpr_events, comparison <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'TAF2OE_uniq'</span>, <span class="st">'NLSTAF2dIDR_uniq'</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">case_when</span>(comparison <span class="sc">==</span> <span class="st">'TAF2OE_uniq'</span> <span class="sc">~</span> <span class="st">'TAF2'</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                comparison <span class="sc">==</span> <span class="st">'NLSTAF2dIDR_uniq'</span> <span class="sc">~</span> <span class="st">'TAF2dIDR'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cmpr_events_mrgd <span class="ot">&lt;-</span> <span class="fu">subset</span>(fltrd_cmpr_events, comparison <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'TAF2OE_mrgd'</span>, <span class="st">'NLSTAF2dIDR_mrgd'</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">case_when</span>(comparison <span class="sc">==</span> <span class="st">'TAF2OE_mrgd'</span> <span class="sc">~</span> <span class="st">'TAF2'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                                comparison <span class="sc">==</span> <span class="st">'NLSTAF2dIDR_mrgd'</span> <span class="sc">~</span> <span class="st">'TAF2dIDR'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the overall quality / confidence of the <code>uniq</code> events</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_quality_score_stacked</span>(cmpr_events_uniq) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'UNIQ comparison'</span>) <span class="ot">-&gt;</span> p_cmpr_scores_bars_uniq</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_quality_score_stacked</span>(cmpr_events_mrgd) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'MRGD comparison'</span>) <span class="ot">-&gt;</span> p_cmpr_scores_bars_mrgd</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>p_cmrp_scores_bar <span class="ot">&lt;-</span> p_cmpr_scores_bars_uniq <span class="sc">/</span> p_cmpr_scores_bars_mrgd</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>p_cmrp_scores_bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/make%20to%20plot%20event%20quality%20score%20plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Besides the different number of events the event-types trend is basically the same, except maybe for the intron retentions. Save bar plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'04_Compare_DSE_Score_Bar.pdf'</span>, <span class="at">plot =</span> p_cmrp_scores_bar, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">6.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the distribution of ∆PSI using a histogram with binwidth of 1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dPSI_hist_grpd</span>(<span class="at">data =</span> cmpr_events_uniq) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'UNIQ comparison'</span>) <span class="ot">-&gt;</span> p_cmpr_dPSI_hist_uniq</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dPSI_hist_grpd</span>(<span class="at">data =</span> cmpr_events_mrgd) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'MRGD comparison'</span>) <span class="ot">-&gt;</span> p_cmpr_dPSI_hist_mrgd</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>hist_list <span class="ot">&lt;-</span> <span class="fu">list</span>(p_cmpr_dPSI_hist_uniq, p_cmpr_dPSI_hist_mrgd)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>p_cmpr_dPSI_hist <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(hist_list, <span class="at">byrow =</span> F, <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>) )</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>p_cmpr_dPSI_hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/make%20grouped%20dPSI%20histogram-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The breath of the ∆PSI is not massive with the <code>uniq</code> comparison. The ∆PSI magnitudes are however somewhat comparable between the 2 OE. Save histogram plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'05_compare_DSE_dPSI_Hist.pdf'</span>, <span class="at">plot =</span> p_cmpr_dPSI_hist, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Explore some specific events differentially</strong></p>
<p>In the boxplot filled circle points indicate individual replicates, while the square points indicate the merge super-sample between the 3 replicates.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>both_TAF2OE_ids <span class="ot">&lt;-</span> events_li<span class="sc">$</span>TAF2OE_mrgd[(events_li<span class="sc">$</span>TAF2OE_mrgd <span class="sc">%in%</span> events_li<span class="sc">$</span>TAF2OE_uniq)]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(both_TAF2OE_ids), <span class="st">' DSEs in TAF2 OE mrgd and uniq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>66 DSEs in TAF2 OE mrgd and uniq</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>both_TAF2dIDR_ids <span class="ot">&lt;-</span> events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd[(events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd <span class="sc">%in%</span> events_li<span class="sc">$</span>NLSTAF2dIDR_uniq)]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(both_TAF2dIDR_ids), <span class="st">' DSEs in NLS-TAF2 ∆IDR OE mrgd and uniq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>66 DSEs in NLS-TAF2 ∆IDR OE mrgd and uniq</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>total_both_both_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(both_TAF2OE_ids, both_TAF2dIDR_ids))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Which sum up to "</span>, <span class="fu">length</span>(total_both_both_ids), <span class="st">' DSEs that are mis-spliced in one or both 2 OE and are shared between mrgd and uniq comparisons'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Which sum up to 118 DSEs that are mis-spliced in one or both 2 OE and are shared between mrgd and uniq comparisons</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cmpr_events_mrgd <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(EVENT <span class="sc">%in%</span> total_both_both_ids ) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( <span class="fu">abs</span>(dPSI) <span class="sc">&gt;=</span> <span class="dv">26</span> ) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI, dPSI, comparison) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dPSI)) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(EVENT) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="ot">-&gt;</span> top_both_both_ids</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># most drastic examples</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(cmpr_events, EVENT <span class="sc">%in%</span> top_both_both_ids) <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">num_col =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.19</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/plot%20some%20events%20of%20both%20both%20kind-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>This plot show some interesting cases. For example, the gene ATG2B has an alternative 3’ acceptor splice site <a href="https://vastdb.crg.eu/event/HsaALTA1004608-3/4@hg38">HsaALTA1004608-3</a> that is clearly an up-regulation only when NLS TAF2 ∆IDR is over expressed. The same trend is observable for <a href="https://vastdb.crg.eu/event/HsaALTD0000934-2/3@hg38">HsaALTD0000934-2/3</a> in the TMEM230 gene.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'06_compare_DSE_PSI_boxplot.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">24</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check events that are differentially spliced in the super sample but not in the 3-replicate comparison.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mrgd_not_uniq_TAF2OE_ids <span class="ot">&lt;-</span> events_li<span class="sc">$</span>TAF2OE_mrgd[<span class="sc">!</span>(events_li<span class="sc">$</span>TAF2OE_mrgd <span class="sc">%in%</span> events_li<span class="sc">$</span>TAF2OE_uniq)]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(mrgd_not_uniq_TAF2OE_ids), <span class="st">' DSEs in TAF2 OE mrgd but not in TAF2 OE uniq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>979 DSEs in TAF2 OE mrgd but not in TAF2 OE uniq</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mrgd_not_uniq_TAF2dIDR_ids <span class="ot">&lt;-</span> events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd[<span class="sc">!</span>(events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd <span class="sc">%in%</span> events_li<span class="sc">$</span>NLSTAF2dIDR_uniq)]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(mrgd_not_uniq_TAF2dIDR_ids), <span class="st">' DSEs in NLS-TAF2∆IDR OE mrgd but not in NLS-TAF2∆IDR OE uniq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>942 DSEs in NLS-TAF2∆IDR OE mrgd but not in NLS-TAF2∆IDR OE uniq</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>total_mrgd_only_both_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(mrgd_not_uniq_TAF2OE_ids, mrgd_not_uniq_TAF2dIDR_ids))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Which sum up to "</span>, <span class="fu">length</span>(total_mrgd_only_both_ids), <span class="st">' DSEs that are mis-spliced in one or both 2 OE in the mrgd super sample comparion only'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Which sum up to 1633 DSEs that are mis-spliced in one or both 2 OE in the mrgd super sample comparion only</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cmpr_events_mrgd <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(EVENT <span class="sc">%in%</span> total_mrgd_only_both_ids) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( <span class="fu">abs</span>(dPSI) <span class="sc">&gt;=</span> <span class="dv">50</span> ) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI, dPSI, comparison) <span class="sc">|&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dPSI)) <span class="sc">|&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(EVENT) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="ot">-&gt;</span> top_mrgd_not_uniq_both_ids</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(cmpr_events, EVENT <span class="sc">%in%</span> top_mrgd_not_uniq_both_ids) <span class="sc">|&gt;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">num_col =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/plot%20some%20events%20of%20in%20the%20super%20sample%20but%20not%20in%20rep%20comparions-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>For these events the individual replicates have a very low coverage (<code>N</code> value in ), however the super sample has enough reads to quantify the PSI more reliably.</p>
<p>The gene SPTLC3 has 5 differentially spliced exons specifically only in the TAF2 OE. These are: - <a href="https://vastdb.crg.eu/event/HsaEX6077214@hg38">HsaEX6077214</a> - <a href="https://vastdb.crg.eu/event/HsaEX6077218@hg38">HsaEX6077218</a> - <a href="https://vastdb.crg.eu/event/HsaEX6077217@hg38">HsaEX6077217</a> - <a href="https://vastdb.crg.eu/event/HsaEX0061607@hg38">HsaEX0061607</a> - <a href="https://vastdb.crg.eu/event/HsaEX0061606@hg38">HsaEX0061606</a></p>
<p>After a closer inspection in vastDB and the genome browser these are very complex cassette exon events that should be further validate experimentally if needed. They all have a similar trend and might be either ORF disrupting or having an uncertain impact.</p>
<p>More interesting case could be the alternative acceptor <a href="https://vastdb.crg.eu/event/HsaALTA1003439-1/2@hg38">HsaALTA1003439-1/2</a> of exon 94 of the SYNE2 gene which seems to be always skipped in basal condition and becomes a used splice site only upon OE.</p>
<p>Check the commonly mis-spliced events between the 2 OE. Get the sample’s PSI only from one of the 2 comparisons as these are common events.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'07_compare_DSE_PSI_boxplot.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">24</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check one specific event in the gene TAF2.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(cmpr_events, EVENT <span class="sc">%in%</span> <span class="st">'HsaEX0063481'</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">num_col =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/plot%20uniq%20events-1.png" class="img-fluid" width="288"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'08_compare_TAF2_exon_PSI_boxplot.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The TAF2 gene has a cryptic alternative exon <a href="https://vastdb.crg.eu/event/HsaEX0063481@hg38">HsaEX0063481</a>, here the PSI goes to zero when TAF2 is OE. I believe this is an due to the fact that the cDNA used for the over-expression excluded this exonic sequence and the TAF2∆IDR is not containing this region encoding the cryptic exon, hence the PSI is similar to the control.</p>
<p><em>Select events that are differentially spliced using the comparison method</em></p>
<p>Given the fact that the replicates are not very deeply sequenced what I’m doing is to create a ‘bona fide’ set of events that are differentially spliced in both the super sample comparison and the comparison with the 3 replicates. In addition, I create a more relaxed set of all events that are mis-spliced (|∆PSI| &gt;= 15) in any of the 2 comparisons. Each set is further divided into shared events between the 2 OE and events specific to each OE.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bona_fide_TAF2_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(events_li<span class="sc">$</span>TAF2OE_mrgd, events_li<span class="sc">$</span>TAF2OE_uniq)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>bona_fide_TAF2dIDR_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd, events_li<span class="sc">$</span>NLSTAF2dIDR_uniq)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>shared_bona_fide_ids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(bona_fide_TAF2_ids, bona_fide_TAF2dIDR_ids)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>specific_bona_fide_TAF2_ids <span class="ot">&lt;-</span> bona_fide_TAF2_ids[<span class="sc">!</span>bona_fide_TAF2_ids <span class="sc">%in%</span> shared_bona_fide_ids]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>specific_bona_fide_TAF2dIDR_ids <span class="ot">&lt;-</span> bona_fide_TAF2dIDR_ids[<span class="sc">!</span>bona_fide_TAF2dIDR_ids <span class="sc">%in%</span> shared_bona_fide_ids]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2_all_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(events_li<span class="sc">$</span>TAF2OE_mrgd, events_li<span class="sc">$</span>TAF2OE_uniq)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>cmpr_TAF2dIDR_all_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(events_li<span class="sc">$</span>NLSTAF2dIDR_mrgd, events_li<span class="sc">$</span>NLSTAF2dIDR_uniq)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>shared_cmpr_all_ids <span class="ot">&lt;-</span>  <span class="fu">intersect</span>(cmpr_TAF2_all_ids, cmpr_TAF2dIDR_all_ids)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>specific_cmpr_TAF2_ids <span class="ot">&lt;-</span> cmpr_TAF2_all_ids[<span class="sc">!</span>cmpr_TAF2_all_ids <span class="sc">%in%</span> shared_cmpr_all_ids]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>specific_cmpr_TAF2dIDR_ids <span class="ot">&lt;-</span> cmpr_TAF2dIDR_all_ids[<span class="sc">!</span>cmpr_TAF2dIDR_all_ids <span class="sc">%in%</span> shared_cmpr_all_ids]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For now it looks like there are some changes in AS and most events are impacted by both OE.</p>
</section>
</section>
<section id="statistical-method-from-tidy" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="statistical-method-from-tidy"><span class="header-section-number">3.2</span> statistical method (from tidy)</h2>
<p>Import tidy dataset. Here tidy means a subset of all identified AS events that have generally a good score, balanced coverage on both splice sites.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="ot">&lt;-</span> <span class="fu">read_vst_tbl</span>(<span class="at">path =</span> tidy_psi_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GENE =</span> <span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">'=Hsa.*$'</span>, <span class="at">string =</span> EVENT) ) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EVENT =</span> <span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">'^*.*='</span>, <span class="at">string =</span> EVENT) ) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(GENE, <span class="at">.before =</span> EVENT) <span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">'HeLA'</span>), <span class="at">names_to =</span> <span class="st">'Sample'</span>, <span class="at">values_to =</span> <span class="st">'PSI'</span>) </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">'Tidy events: '</span>, <span class="fu">length</span>(<span class="fu">unique</span>(tidy_events<span class="sc">$</span>EVENT)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Tidy events: 9350</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tidy_events_backup <span class="ot">&lt;-</span> tidy_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="pca" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="pca"><span class="header-section-number">3.2.1</span> PCA</h3>
<p>First let’s use these events to check the dispersion of the samples with a PCA. First turn the PSI dataframe into a matrix</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> EVENT, <span class="at">names_from =</span> Sample, <span class="at">values_from =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">'EVENT'</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> tidy_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the PCA using the function <code>showme_PCA2D</code> form my R package and save it.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">showme_PCA2D</span>(<span class="fu">log2</span>(tidy_mat), <span class="at">mt =</span> mtdf, <span class="at">mcol =</span> <span class="st">'Sample'</span>, <span class="at">real_aspect_ratio =</span> T,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">m_fill =</span> <span class="st">'OE'</span>, <span class="at">m_label =</span> <span class="st">'PrettySample'</span>, <span class="at">n_top_var =</span> <span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/Plot%20PCA-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'09_tidy_PCA.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Samples group well between each other. Principal component one separates based on the OE, while component two separates more the TAF2 ∆IDR from the other 2. The next plot shows how much variance each component explains.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">showme_PCA2D</span>(<span class="fu">log2</span>(tidy_mat), <span class="at">mt =</span> mtdf, <span class="at">mcol =</span> <span class="st">'Sample'</span>, <span class="at">show_variance =</span> T, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">real_aspect_ratio =</span> F, <span class="at">m_fill =</span> <span class="st">'OE'</span>, <span class="at">m_label =</span> <span class="st">'PrettySample'</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">n_top_var =</span> <span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/PCA%203-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Check which events are the most prominent on component 1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">showme_PCA2D</span>(<span class="fu">log2</span>(tidy_mat), <span class="at">mt =</span> mtdf, <span class="at">mcol =</span> <span class="st">'Sample'</span>, <span class="at">n_loadings =</span> <span class="dv">10</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">n_top_var =</span> <span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/show%20loading%20component%201-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Save all 1000 loadings of all components in a table</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">showme_PCA2D</span>(<span class="fu">log2</span>(tidy_mat), <span class="at">mt =</span> mtdf, <span class="at">mcol =</span> <span class="st">'Sample'</span>, <span class="at">n_loadings =</span> <span class="dv">10</span>,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">return_data =</span> T, <span class="at">n_top_var =</span> <span class="dv">1000</span>) <span class="ot">-&gt;</span> tidy_loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="heatmaps" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="heatmaps"><span class="header-section-number">3.2.2</span> Heatmaps</h3>
<p>Explore the samples with a heatmap of the AS events. First let’s check how many events are missing the PSI (e.g.&nbsp;not enough coverage). In the next heatmap white represent <code>NA</code> values and black represent a quantification (from 0 to 100). Of course the merged super samples have more coverage. I don’t think there’s a specific patter and I’d say that the values are missing at random.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(tidy_mat, <span class="at">na_col =</span> <span class="st">'white'</span>, <span class="at">cluster_rows =</span> F, <span class="at">cluster_cols =</span> T,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend =</span> F, <span class="at">show_rownames =</span> F, <span class="at">color =</span> <span class="st">'black'</span>, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste0</span>( <span class="fu">nrow</span>(tidy_mat), <span class="st">' AS events'</span> ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/heatmap%20NA%20values-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Since the the super samples have more coverage let’s plot only the AS events in those 3 columns. <code>NA</code> are again displayed in white.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(tidy_mat[, <span class="fu">c</span>(<span class="st">'HeLa_FRT'</span>, <span class="st">'HeLa_TAF2'</span>, <span class="st">'HeLa_NLSTAF2dIDR'</span>)], </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">na_col =</span> <span class="st">'white'</span>, <span class="at">cluster_rows =</span> F, <span class="at">cluster_cols =</span> T,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste0</span>( <span class="fu">nrow</span>(tidy_mat), <span class="st">' AS events'</span>) ,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F, <span class="at">color =</span> <span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>), <span class="at">cutree_cols =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/heatmap%20super%20samples-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>The control sample separates from the other 2 OE. Now with the replicates only. Since the replicates have some <code>NA</code>s let’s try to select only the events with at least coverage in 5 out of all 9 samples.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Replicate <span class="sc">!=</span> <span class="st">'Merge'</span> ) <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samples_w_NA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI))) <span class="sc">|&gt;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(samples_w_NA, <span class="at">.after =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(samples_w_NA <span class="sc">&lt;=</span> <span class="dv">4</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI) <span class="sc">|&gt;</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> EVENT, <span class="at">names_from =</span> Sample, <span class="at">values_from =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">'EVENT'</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> tidy_fltrd_mat</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(tidy_fltrd_mat, <span class="at">na_col =</span> <span class="st">'white'</span>, <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F, <span class="at">color =</span> <span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>), <span class="at">treeheight_col =</span> <span class="dv">25</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste0</span>(<span class="fu">nrow</span>(tidy_fltrd_mat), <span class="st">' AS event'</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/select%20by%20coverage%20and%20make%20heatmap-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Now plot only the events that have full coverage in across all 9 samples.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Replicate <span class="sc">!=</span> <span class="st">'Merge'</span> ) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samples_w_NA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI))) <span class="sc">|&gt;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(samples_w_NA, <span class="at">.after =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(samples_w_NA <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI) <span class="sc">|&gt;</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> EVENT, <span class="at">names_from =</span> Sample, <span class="at">values_from =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">'EVENT'</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> tidy_full_mat</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(tidy_full_mat, <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T, </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="fu">nrow</span>(tidy_full_mat), <span class="st">' AS event with full coverage'</span>),</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/heatmap%20zscores%20replicates-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Things change a little bit and replicates tend to cluster together more.</p>
<p>Now check how events change between conditions, to do this I calculate the z score to scale the PSI of each event between the the super samples.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Replicate <span class="sc">==</span> <span class="st">'Merge'</span> ) <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samples_w_NA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI))) <span class="sc">|&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(samples_w_NA, <span class="at">.after =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(samples_w_NA <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, Sample, PSI) <span class="sc">|&gt;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> EVENT, <span class="at">names_from =</span> Sample, <span class="at">values_from =</span> PSI) <span class="sc">|&gt;</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">'EVENT'</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> tidy_full_mat</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">zScore</span>(tidy_full_mat), <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="fu">nrow</span>(tidy_full_mat), <span class="st">' AS event with full coverage'</span>),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">met.brewer</span>(<span class="st">"Benedictus"</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">'continuous'</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/heatmap%20zscores%20super%20sample-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The effect of the change (i.e.&nbsp;PSI between different conditions) is not very big. However I think this method can pick up some lowly expressed genes with different AS splicing pattern. For example let’s select the top &amp; bottom 5 AS events with difference relative to the control after the PSI are logit transformed.</p>
<div class="cell" data-evel="false">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>logit_tidy_full_mat <span class="ot">&lt;-</span> <span class="fu">log10</span>(tidy_full_mat <span class="sc">/</span> (<span class="dv">100</span><span class="sc">-</span>tidy_full_mat))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># select only finite events (PSI = 0, and 100 are removed in the logit transformation)</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>finite_logit_tidy_full_mat <span class="ot">&lt;-</span> logit_tidy_full_mat[<span class="fu">is.finite</span>(<span class="fu">rowSums</span>(logit_tidy_full_mat)), ]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">zScore</span>(finite_logit_tidy_full_mat), <span class="at">cluster_rows =</span> T, <span class="at">cluster_cols =</span> T,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste0</span>(<span class="fu">nrow</span>(finite_logit_tidy_full_mat), <span class="st">' AS event with full coverage after logit'</span>),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">met.brewer</span>(<span class="st">"Benedictus"</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">'continuous'</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle_col =</span> <span class="dv">315</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/heatmap%20of%20logit%20transformation-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Extract the top and bottom event relative to control.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zScore</span>(finite_logit_tidy_full_mat) <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">'EVENT'</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(HeLa_FRT)) <span class="sc">|&gt;</span> (\(x) {</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>( <span class="fu">head</span>(x, <span class="dv">5</span>), <span class="fu">tail</span>(x, <span class="dv">5</span>) )</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    })()  <span class="sc">|&gt;</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(EVENT) <span class="ot">-&gt;</span> top_bottom_events_logit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check their PSI distribution across samples. Since the <code>tidy</code> table does not contain the quality scores and the PSI of these events in not present in the <code>compare</code> table I get the PSI from the full inclusion table.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep_psi</span>(<span class="at">inclusion_tbl =</span> psi_path, <span class="at">vst_id =</span> top_bottom_events_logit) <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_vst_psi</span>() <span class="ot">-&gt;</span> top_bottom_psi_logit</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>top_bottom_psi_logit <span class="sc">|&gt;</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">order_by_dPSI =</span> F) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/psi%20plot%20logit-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>These could be differentially spliced events that are barely not making the cut to be considered by the <code>compare</code> method, however the events in the plot above were selected based on the magnitude of logit normalisation.</p>
</section>
<section id="testing-for-significance" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="testing-for-significance"><span class="header-section-number">3.2.3</span> Testing for significance</h3>
<p>A better way to detect this kind of subtle changes with a more robust statistical framework is to calculate a <em>P</em>-value using the individual replicates PSI and plot them against the ∆PSI as a <strong>Volcano plot</strong>. To achieve this first define the sample types.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mrgd_cntrl <span class="ot">&lt;-</span> <span class="st">"HeLa_FRT"</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>mrgd_TAF2OE <span class="ot">&lt;-</span> <span class="st">"HeLa_TAF2"</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>mrgd_NLSTAF2dIDROE <span class="ot">&lt;-</span> <span class="st">"HeLa_NLSTAF2dIDR"</span> </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>taf2oe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'HeLa_TAF2_A'</span>, <span class="st">'HeLa_TAF2_B'</span>, <span class="st">'HeLa_TAF2_C'</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>taf2didr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'HeLa_NLSTAF2dIDR_A'</span>, <span class="st">'HeLa_NLSTAF2dIDR_B'</span>, <span class="st">'HeLa_NLSTAF2dIDR_C'</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>cntrls <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'HeLa_FRT_A'</span>, <span class="st">'HeLa_FRT_B'</span>, <span class="st">'HeLa_FRT_C'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Filter for samples that have finite ∆PSI (meaning that is not just NA), that have maximum one sample per condition as NA (meaning at least 2 samples are not NA).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mPSI_TAF2 =</span> <span class="fu">mean</span>(PSI[Sample <span class="sc">%in%</span> mrgd_TAF2OE], <span class="at">na.rm =</span> T),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mPSI_TAF2dIDR =</span> <span class="fu">mean</span>(PSI[Sample <span class="sc">%in%</span> mrgd_NLSTAF2dIDROE], <span class="at">na.rm =</span> T),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mPSI_CNTRL =</span> <span class="fu">mean</span>(PSI[Sample <span class="sc">%in%</span> mrgd_cntrl], <span class="at">na.rm =</span> T),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">Samples_NA_TAF2 =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI[Sample <span class="sc">%in%</span> taf2oe])),</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">Samples_NA_TAF2dIDR =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI[Sample <span class="sc">%in%</span> taf2didr])),</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">Samples_NA_CNTRL =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(PSI[Sample <span class="sc">%in%</span> cntrls])) ) <span class="sc">|&gt;</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dPSI_TAF2 =</span> mPSI_TAF2 <span class="sc">-</span> mPSI_CNTRL,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">dPSI_TAF2dIDR =</span> mPSI_TAF2dIDR <span class="sc">-</span> mPSI_CNTRL ) <span class="sc">|&gt;</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.finite</span>(dPSI_TAF2) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(dPSI_TAF2dIDR) ) <span class="sc">|&gt;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select samples with max 1 NA PSI value per event </span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( Samples_NA_TAF2 <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( Samples_NA_TAF2dIDR <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( Samples_NA_CNTRL <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(EVENT, dPSI_TAF2, dPSI_TAF2dIDR) <span class="sc">|&gt;</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> tidy_events, <span class="at">by =</span> <span class="fu">join_by</span>(EVENT)) <span class="sc">|&gt;</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(GENE, <span class="at">.before =</span> EVENT) <span class="sc">|&gt;</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">'dPSI'</span>), <span class="at">.after =</span> PSI) <span class="ot">-&gt;</span> tidy_dPSI_df</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(<span class="fu">unique</span>(tidy_dPSI_df<span class="sc">$</span>EVENT)), <span class="st">'/'</span>, </span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(tidy_events<span class="sc">$</span>EVENT)), </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">' filtered events for stat difference analysis'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>3904/9350 filtered events for stat difference analysis</code></pre>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following analysis will use Student’s <em>t</em>-test on PSI values that are bounded between 0 and 100. Some people might find this “statistically wrong” as the PSI distribution does not follow normality. My argument is that PSI is close enough to normality to allow the use of a <em>t</em>-test and the test itself is pretty robust to non-normality anyway. This means that I believe <a href="https://twitter.com/wolfgangkhuber/status/1297842432281911296">I <em>can</em> use the <em>t</em>-test for this data; not that I <em>should</em></a>. I addition I’ll repeat the analysis with the Wilcoxon signed-rank test and check how much the results change.</p>
</div>
</div>
<p>Now that I stated my views on why testing for normality is basically useless, I’m going to test for that :)</p>
<p>I’ll start by using the TAF2 OE PSI and use the same mean and standard deviation of those PSI to generate a normally distributed random PSI.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span> Replicate <span class="sc">==</span> <span class="st">'Merge'</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( OE <span class="sc">!=</span> <span class="st">'NLSTAF2dIDR'</span>)  <span class="sc">|&gt;</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only events that are changing a bit to enter the test</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if not the data is essentially constant and statistical test fails </span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( <span class="fu">abs</span>(dPSI_TAF2) <span class="sc">&gt;</span> <span class="fl">0.01</span> ) <span class="sc">|&gt;</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(EVENT, PSI, Replicate) <span class="sc">|&gt;</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(PSI)) <span class="ot">-&gt;</span> test_taf2_dat</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>test_taf2_dat<span class="sc">$</span>PSI_Norm <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(test_taf2_dat<span class="sc">$</span>PSI),</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">mean =</span> <span class="fu">mean</span>(test_taf2_dat<span class="sc">$</span>PSI),</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sd =</span> <span class="fu">sd</span>(test_taf2_dat<span class="sc">$</span>PSI) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The first test I do is simply checking the real data and the theoretical normal distributions</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>test_taf2_dat <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">'PSI'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> name) ) <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The real data is inflated for zeros (full skipping) and 100 (full inclusion) which expected, however the PSI in the middle to resemble a normal distribution, in fact binning the data into 10 bins shows a more similar overlap</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>test_taf2_dat <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">'PSI'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> name) ) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>, <span class="at">colour =</span> <span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lastly I do a quantile-quantile plot:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>test_taf2_dat <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> PSI)) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">110</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/qq%20plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that this concerns have been solved, I calculate <em>P</em>-values for TAF2 OE</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span> Replicate <span class="sc">==</span> <span class="st">'Merge'</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( OE <span class="sc">!=</span> <span class="st">'NLSTAF2dIDR'</span>)  <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only events that are changing a bit to enter the test</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if not the data is essentially constant and statistical test fails </span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( <span class="fu">abs</span>(dPSI_TAF2) <span class="sc">&gt;</span> <span class="fl">0.01</span> )  <span class="sc">|&gt;</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t_test</span>( PSI <span class="sc">~</span> OE, <span class="at">ref.group =</span> <span class="st">'FRT'</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">detailed =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_pvalue</span>(<span class="at">method =</span> <span class="st">"BH"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_significance</span>(<span class="st">"p.adj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(EVENT, p, p.adj, p.adj.signif) <span class="sc">|&gt;</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'EVENT'</span>, <span class="st">'p_TAF2'</span>, <span class="st">'padj_TAF2'</span>, <span class="st">'padj_signif_TAF2'</span>)) <span class="ot">-&gt;</span> pvals_TAF2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculate <em>P</em>-values (wilcoxon test) for NLS TAF2 ∆IDR OE</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span> Replicate <span class="sc">==</span> <span class="st">'Merge'</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( OE <span class="sc">!=</span> <span class="st">'TAF2'</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only events that are changing a bit to enter the test</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if not the data is essentially constant and statistical test fails </span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>( <span class="fu">abs</span>(dPSI_TAF2dIDR) <span class="sc">&gt;</span> <span class="fl">0.01</span> )  <span class="sc">|&gt;</span> </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EVENT) <span class="sc">|&gt;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t_test</span>( PSI <span class="sc">~</span> OE, <span class="at">ref.group =</span> <span class="st">'FRT'</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">detailed =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_pvalue</span>(<span class="at">method =</span> <span class="st">"BH"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_significance</span>(<span class="st">"p.adj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(EVENT, p, p.adj, p.adj.signif) <span class="sc">|&gt;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'EVENT'</span>, <span class="st">'p_TAF2dIDR'</span>, <span class="st">'padj_TAF2dIDR'</span>, <span class="st">'padj_signif_TAF2dIDR'</span>)) <span class="ot">-&gt;</span> pvals_TAF2dIDR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine all dataframes into 1 and set thresholds for significance.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> pvals_TAF2, <span class="at">by =</span> <span class="fu">join_by</span>(EVENT)) <span class="sc">|&gt;</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> pvals_TAF2dIDR, <span class="at">by =</span> <span class="fu">join_by</span>(EVENT)) <span class="ot">-&gt;</span> tidy_dPSI_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I also check the <em>P</em>-value distribution.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(EVENT, p_TAF2, p_TAF2dIDR) <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"p"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> name) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">25</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 504 rows containing non-finite values (`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/check%20pvalue%20distribution-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Set thershold and prepare ffor plotting</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dPSI_thrshld <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>pval_thrshld <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># adjusted p-value threshold </span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>dPSI_squish <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>tidy_dPSI_df <span class="sc">|&gt;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if pvalues is NA change it to 1</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">'p'</span>), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x), <span class="at">yes =</span> <span class="dv">1</span>, <span class="at">no =</span> .x))) <span class="sc">|&gt;</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># label the events that are below significant thresholds</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DSE_TAF2 =</span> p_TAF2 <span class="sc">&lt;</span> pval_thrshld <span class="sc">&amp;</span> <span class="fu">abs</span>(dPSI_TAF2) <span class="sc">&gt;=</span> dPSI_thrshld ) <span class="sc">|&gt;</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DSE_TAF2dIDR =</span> p_TAF2dIDR <span class="sc">&lt;</span> pval_thrshld <span class="sc">&amp;</span> <span class="fu">abs</span>(dPSI_TAF2dIDR) <span class="sc">&gt;=</span> dPSI_thrshld ) <span class="ot">-&gt;</span> tidy_dPSI_pval_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="volcano-plots" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="volcano-plots"><span class="header-section-number">3.2.4</span> Volcano plots</h3>
<p>Volcano plot of TAF2 OE. Points with |∆PSI| &gt; 40 are squished on the sides of the plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select fewer columns for plotting</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(tidy_dPSI_pval_df, OE <span class="sc">==</span> <span class="st">'TAF2'</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, dPSI_TAF2, p_TAF2, padj_TAF2, DSE_TAF2) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="ot">-&gt;</span> plot_TAF2</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_TAF2) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> dPSI_TAF2, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_TAF2), <span class="at">fill =</span> DSE_TAF2) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(pval_thrshld), <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span>dPSI_thrshld, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dPSI_thrshld, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">show.legend =</span> F, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">subset</span>(plot_TAF2, DSE_TAF2),</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> GENE, <span class="at">x =</span> dPSI_TAF2, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_TAF2)),</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">seed =</span> <span class="dv">16</span>, <span class="at">show.legend =</span> F, <span class="at">segment.curvature =</span> <span class="sc">-</span><span class="fl">1e-20</span>,</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">segment.color =</span> <span class="st">'black'</span>, <span class="at">verbose =</span> F, <span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">box.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"mm"</span>),</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">point.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.55</span>, <span class="st">"mm"</span>),</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max.overlaps =</span> <span class="dv">20</span> ) <span class="sc">+</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'gray84'</span>, <span class="st">'firebrick3'</span>) ) <span class="sc">+</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">oob =</span> scales<span class="sc">::</span>squish, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>dPSI_squish, dPSI_squish),</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>, <span class="at">add =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>), <span class="at">add =</span> <span class="dv">0</span>) ) <span class="sc">+</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">4.25</span>)) <span class="sc">+</span> <span class="co"># set this to have the 2 volcano plots with the same Y-axis range</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'-log10 pvalue'</span>, <span class="at">x =</span> <span class="st">"\u0394PSI (TAF2 OE - Cntrl)"</span>) <span class="sc">+</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>) <span class="sc">+</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.1</span>),</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/volcano%20plot%20TAF2-1.png" class="img-fluid" width="480"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'10_tidy_TAF2_Volcano.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Select the differentially spliced events in TAF2 OE and plot only the exon skipping events.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>stat_TAF2 <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">subset</span>(plot_TAF2, DSE_TAF2)<span class="sc">$</span>EVENT)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(stat_TAF2), <span class="st">' significant events with low ∆PSI in TAF2 OE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>33 significant events with low ∆PSI in TAF2 OE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select some events to plot</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>subset_stat_TAF2 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">'HsaEX'</span>, <span class="at">x =</span> stat_TAF2, <span class="at">value =</span> T)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>subset_stat_TAF2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'HsaEX0065488'</span>, <span class="fu">sample</span>(stat_TAF2[stat_TAF2 <span class="sc">!=</span> <span class="st">"HsaEX0065488"</span>], <span class="at">size =</span> <span class="dv">8</span>) )</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">grep_psi</span>(<span class="at">inclusion_tbl =</span> psi_path, <span class="at">vst_id =</span> subset_stat_TAF2 ) <span class="sc">|&gt;</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_vst_psi</span>() <span class="ot">-&gt;</span> psi_stat_TAF2</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>psi_stat_TAF2 <span class="sc">|&gt;</span> </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample)) <span class="sc">|&gt;</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">order_by_dPSI =</span> F, <span class="at">num_col =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/select%20stat%20TAF2-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The event <a href="https://vastdb.crg.eu/event/HsaEX0065488@hg38">HsaEX0065488</a> in the gene TMEM143 seems to have a TAF2 OE specific skipping effect. In fact, this event was not found in the compare method due to the default limit of a ∆PSI &gt;=15</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="st">"HsaEX0065488"</span> <span class="sc">%in%</span> shared_cmpr_all_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>So in this way we don’t have to lower the threshold and risk of obtaining to many false positives, but we can only extract significant events with a low difference in ∆PSI.</p>
<p>Volcano plot of NLS-TAF2 ∆IDR OE. Points with |∆PSI| &gt; 40 are squished on the sides of the plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(tidy_dPSI_pval_df, OE <span class="sc">==</span> <span class="st">'NLSTAF2dIDR'</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE, EVENT, dPSI_TAF2dIDR, p_TAF2dIDR, padj_TAF2dIDR, DSE_TAF2dIDR) <span class="sc">|&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="ot">-&gt;</span> plot_TAF2dIDR</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_TAF2dIDR) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> dPSI_TAF2dIDR, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_TAF2dIDR), <span class="at">fill =</span> DSE_TAF2dIDR) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(pval_thrshld), <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span>dPSI_thrshld, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dPSI_thrshld, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">show.legend =</span> F, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">subset</span>(plot_TAF2dIDR, DSE_TAF2dIDR), </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> GENE, <span class="at">x =</span> dPSI_TAF2dIDR, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_TAF2dIDR)),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">16</span>, <span class="at">show.legend =</span> F, <span class="at">segment.curvature =</span> <span class="sc">-</span><span class="fl">1e-20</span>, </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.25</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="st">'black'</span>,<span class="at">verbose =</span> F, </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"mm"</span>),</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">point.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.55</span>, <span class="st">"mm"</span>),</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps =</span> <span class="dv">20</span> ) <span class="sc">+</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'gray84'</span>, <span class="st">'firebrick3'</span>) ) <span class="sc">+</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">oob =</span> scales<span class="sc">::</span>squish, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>dPSI_squish, dPSI_squish),</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>, <span class="at">add =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>), <span class="at">add =</span> <span class="dv">0</span>) ) <span class="sc">+</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'-log10 pvalue'</span>, <span class="at">x =</span> <span class="st">"\u0394PSI (NLS-TAF2 \u0394IDR OE - Cntrl)"</span>) <span class="sc">+</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">4.25</span>)) <span class="sc">+</span> <span class="co"># set this to have the 2 volcano plots with the same Y-axis range</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>) <span class="sc">+</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.1</span>),</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/volcano%20plot%20TAF2%20dIDR-1.png" class="img-fluid" width="480"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'Tidy_TAF2dIDR_Volcano.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> plot_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Select the differentially spliced events in TAF2 ∆IDR OE and plot only the exon skipping events.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>stat_TAF2dIDR <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">subset</span>(plot_TAF2dIDR, DSE_TAF2dIDR)<span class="sc">$</span>EVENT)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(stat_TAF2dIDR), <span class="st">' significant events with low ∆PSI in TAF2 ∆IDR OE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>12 significant events with low ∆PSI in TAF2 ∆IDR OE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select some events to plot</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>subset_stat_TAF2dIDR <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">'^HsaEX'</span>, <span class="at">x =</span> stat_TAF2dIDR, <span class="at">value =</span> T)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">length</span>(subset_stat_TAF2dIDR) <span class="sc">&gt;=</span> <span class="dv">9</span> ){</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  subset_stat_TAF2dIDR <span class="ot">&lt;-</span> <span class="fu">sample</span>(subset_stat_TAF2dIDR, <span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grep_psi</span>(<span class="at">inclusion_tbl =</span> psi_path, <span class="at">vst_id =</span> subset_stat_TAF2dIDR ) <span class="sc">|&gt;</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_vst_psi</span>() <span class="ot">-&gt;</span> psi_stat_TAF2dIDR</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>psi_stat_TAF2dIDR <span class="sc">|&gt;</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PSI_boxplot</span>(<span class="at">order_by_dPSI =</span> F, <span class="at">num_col =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/select%20stat%20TAF2dIDR-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The exon skipping event <a href="https://vastdb.crg.eu/event/HsaEX0029450@hg38">HsaEX0029450</a> is in the <em>HDAC8</em> gene seems quite interesting as it is an ORF preserving event. Also the event <a href="https://vastdb.crg.eu/event/HsaEX0058132@hg38">HsaEX0058132</a> is in the SHANK associated RH domain interactor (<em>SHARPIN</em>) seems quite interesting.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="st">"HsaEX0029450"</span> <span class="sc">%in%</span> shared_cmpr_all_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>With this approach we can include some more AS events to the DSE list.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>stat_both_oe_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(stat_TAF2, stat_TAF2dIDR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="appendix-with-wilcoxon-test" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="appendix-with-wilcoxon-test"><span class="header-section-number">3.2.5</span> Appendix with wilcoxon test</h3>
<p>For statistical fairness repeat the analysis and check overlap with t-test.</p>
</section>
</section>
<section id="bayesian-method-from-diff" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="bayesian-method-from-diff"><span class="header-section-number">3.3</span> Bayesian method (from diff)</h2>
<p>Import the vast-tools diff tables. Note: diff outputs PSIs from 0 to 1, so I multiply them by 100.</p>
<p>This tables were create with this command line short cut:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-n</span> +2 Diff_output_all_events_noB3_pIR.tab <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">awk</span> <span class="st">'{OFS="\t"} { if($6 &gt;= 0.15) print $1, $2, $5, $6}'</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sort</span> <span class="at">-k3,4nr</span>  <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-e</span> <span class="st">$'1iGENE</span><span class="dt">\t</span><span class="st">EVENT</span><span class="dt">\t</span><span class="st">dPSI</span><span class="dt">\t</span><span class="st">MVdPSIat95'</span> <span class="op">&gt;</span> Fltrd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Which filters for events with a minimum value of |∆PSI| &gt;= 15 with a 95% confidence (column number 6) and sorts them by observed ∆PSI (column number 5).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>diff_TAF2 <span class="ot">&lt;-</span> <span class="fu">read_vst_tbl</span>(<span class="at">path =</span> diff_TAF2_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dPSI =</span> dPSI <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>diff_TAF2dIDR <span class="ot">&lt;-</span> <span class="fu">read_vst_tbl</span>(<span class="at">path =</span> diff_TAF2dIDR_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dPSI =</span> dPSI <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How many AS events?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>diff_events_TAF2 <span class="ot">&lt;-</span> <span class="fu">unique</span>(diff_TAF2<span class="sc">$</span>EVENT)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(diff_events_TAF2), <span class="st">' diff events TAF2 OE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>130 diff events TAF2 OE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>diff_events_TAF2dIDR <span class="ot">&lt;-</span> <span class="fu">unique</span>(diff_TAF2dIDR<span class="sc">$</span>EVENT)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(diff_events_TAF2dIDR), <span class="st">' diff events TAF2 ∆IDR OE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>158 diff events TAF2 ∆IDR OE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>diff_events_common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(diff_events_TAF2, diff_events_TAF2dIDR)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(diff_events_common), <span class="st">' diff events common between both OE'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>27 diff events common between both OE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a list with the DSE of each OE</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>diff_events_TAF2_only <span class="ot">&lt;-</span> diff_events_TAF2[(<span class="sc">!</span> diff_events_TAF2 <span class="sc">%in%</span> diff_events_common)]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>diff_events_TAF2dIDR_only <span class="ot">&lt;-</span> diff_events_TAF2dIDR[(<span class="sc">!</span> diff_events_TAF2dIDR <span class="sc">%in%</span> diff_events_common)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Interestingly not many events are common between the 2 OE.</p>
<p>Plot the actual ∆PSI of the events that were filtered to have a minimum value of |∆PSI| &gt;=15 with a 95% confidence.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hist_dPSI</span>(diff_TAF2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/diff%20TAF2%20hist-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There seem to be a good balance between up and down regulated events.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hist_dPSI</span>(diff_TAF2dIDR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/diff%20TAF2%20dIDR%20hist-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These seems to be more down regulated AS events in TAF2 ∆IDR OE.</p>
<p>The diff table does not contain all the information about the AS event as the main full inclusion table so I get such info from the full inclusion table.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fetch_diff_IDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(diff_events_TAF2, diff_events_TAF2dIDR))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">length</span>(fetch_diff_IDs), <span class="st">' events to get info... this may take some time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>261 events to get info... this may take some time</code></pre>
</div>
</div>
<p>This next step might take some time to process.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep_psi</span>(<span class="at">inclusion_tbl =</span> psi_path, <span class="at">vst_id =</span> fetch_diff_IDs) <span class="sc">|&gt;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_vst_psi</span>() <span class="ot">-&gt;</span> diff_psi_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To avoid having to repeat this step in the future I save this dataframe to file and not execute the code chunk above any more.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>diff_psi_df <span class="ot">&lt;-</span> diff_psi_df <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comparison =</span> <span class="fu">case_when</span>(EVENT <span class="sc">%in%</span> diff_events_TAF2_only <span class="sc">~</span> <span class="st">'TAF2'</span>,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                                EVENT <span class="sc">%in%</span> diff_events_TAF2dIDR_only <span class="sc">~</span> <span class="st">'TAF2dIDR'</span>,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                                EVENT <span class="sc">%in%</span> diff_events_common <span class="sc">~</span> <span class="st">'BOTH'</span> ) )</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(<span class="at">x =</span> diff_psi_df, <span class="at">file =</span> <span class="fu">file.path</span>(diff_dir, <span class="st">'Fltrd_Annotated_Diff_Events_HeLa_Both_OE.tab'</span>),</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">delim =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import the table that was written the first time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>diff_psi_df <span class="ot">&lt;-</span> <span class="fu">read_vst_tbl</span>(<span class="at">path =</span> <span class="fu">file.path</span>(diff_dir, <span class="st">'Fltrd_Annotated_Diff_Events_HeLa_Both_OE.tab'</span>),</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Quick check</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diff_psi_df) <span class="sc">+</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> comparison, <span class="at">y =</span> LENGTH) <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>COMPLEX) <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">'log10'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/quick%20plot%20diff-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="integrate-all-events" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="integrate-all-events"><span class="header-section-number">3.4</span> integrate all events</h2>
<p>From the 3 different methods.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>cmpr_events <span class="sc">|&gt;</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>dPSI) <span class="sc">|&gt;</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">'compare'</span>) <span class="ot">-&gt;</span> set_cmpr</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>tidy_events <span class="sc">|&gt;</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(EVENT <span class="sc">%in%</span> <span class="fu">c</span>(stat_TAF2, stat_TAF2dIDR) ) <span class="sc">|&gt;</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> mtdf, <span class="at">by =</span> <span class="fu">join_by</span>(Sample) ) <span class="sc">|&gt;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">'tidy'</span>) <span class="ot">-&gt;</span> set_tidy</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>diff_psi_df <span class="sc">|&gt;</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">'diff'</span>)  <span class="ot">-&gt;</span> set_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>cols_to_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">'EVENT'</span>, <span class="st">'Sample'</span>, <span class="st">'PSI'</span>, <span class="st">'method'</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>( <span class="fu">unique</span>(set_cmpr[, cols_to_keep]) ,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">unique</span>(set_tidy[, cols_to_keep]) ,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">unique</span>(set_diff[, cols_to_keep]) ) <span class="sc">|&gt;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(GENE, EVENT, method), <span class="at">names_from =</span> Sample, <span class="at">values_from =</span> PSI ) <span class="sc">|&gt;</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">factor</span>(method, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'compare'</span>, <span class="st">'tidy'</span>, <span class="st">'diff'</span>))) <span class="sc">|&gt;</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="ot">-&gt;</span> ALL_DSE_WIDE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,064 × 15
  GENE   EVENT method HeLa_FRT HeLa_FRT_A HeLa_FRT_B HeLa_FRT_C HeLa_NLSTAF2dIDR
  &lt;chr&gt;  &lt;chr&gt; &lt;fct&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;
1 SLC25… HsaE… compa…     70.3       75.5       85.8       49.2             49.8
2 CELSR3 HsaE… compa…     84.3       62.5      100         88.9             59.0
3 LTK    HsaE… compa…    100        100        100        100               80.9
4 SPEG   HsaE… compa…     93.3       84.6      100        100               77.1
5 TRNT1  HsaE… compa…     60.1       49.7       72.0       57.3             42.0
# ℹ 2,059 more rows
# ℹ 7 more variables: HeLa_NLSTAF2dIDR_A &lt;dbl&gt;, HeLa_NLSTAF2dIDR_B &lt;dbl&gt;,
#   HeLa_NLSTAF2dIDR_C &lt;dbl&gt;, HeLa_TAF2 &lt;dbl&gt;, HeLa_TAF2_A &lt;dbl&gt;,
#   HeLa_TAF2_B &lt;dbl&gt;, HeLa_TAF2_C &lt;dbl&gt;</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>ALL_DSE_WIDE <span class="sc">|&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(method) <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'method'</span>, <span class="st">'num'</span>) ) <span class="ot">-&gt;</span> num_DSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot how many Differentially Spliced Events by method?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(num_DSE) <span class="sc">+</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> num, <span class="at">fill =</span> method) <span class="sc">+</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>( <span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">show.legend =</span> F, <span class="at">linewidth =</span> <span class="fl">0.2</span> ) <span class="sc">+</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> num), <span class="at">nudge_y =</span> <span class="dv">7</span>, <span class="at">size =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Num of DSE'</span>) <span class="sc">+</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.03</span>), <span class="at">add =</span> <span class="dv">0</span>), </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n.breaks =</span> <span class="dv">8</span> )<span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>, <span class="at">base_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">'gray84'</span>),</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/DSE%20plot%20count-1.png" class="img-fluid" width="288"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">'Num_DSE_Bar.pdf'</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> cairo_pdf, <span class="at">path =</span> expr_dir, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Show as a stacked bar plot</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(num_DSE, <span class="fu">aes</span>(<span class="at">fill =</span> method, <span class="at">x =</span> num, <span class="at">y =</span> <span class="st">'method'</span>)) <span class="sc">+</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">colour =</span> <span class="st">'black'</span>, <span class="at">show.legend =</span> T, <span class="at">linewidth =</span> <span class="fl">0.2</span> ) <span class="sc">+</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Num of DSE'</span>) <span class="sc">+</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.03</span>), <span class="at">add =</span> <span class="dv">0</span>), </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.breaks =</span> <span class="dv">8</span> )<span class="sc">+</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(<span class="at">base_family =</span> <span class="st">'Arial'</span>, <span class="at">base_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">'gray84'</span>),</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="at">units =</span> <span class="st">'mm'</span>),</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.2</span>),</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'black'</span>),</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/DSE%20plot%20count%20stacked-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>In total there are ~450 events that are the most likely differentially spliced.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>cmpr_ids <span class="ot">&lt;-</span> <span class="fu">subset</span>(ALL_DSE_WIDE, method <span class="sc">==</span> <span class="st">'compare'</span>)<span class="sc">$</span>EVENT</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>tidy_ids <span class="ot">&lt;-</span> <span class="fu">subset</span>(ALL_DSE_WIDE, method <span class="sc">==</span> <span class="st">'tidy'</span>)<span class="sc">$</span>EVENT</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>diff_ids <span class="ot">&lt;-</span> <span class="fu">subset</span>(ALL_DSE_WIDE, method <span class="sc">==</span> <span class="st">'diff'</span>)<span class="sc">$</span>EVENT</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>method_ids <span class="ot">&lt;-</span> <span class="fu">list</span>(cmpr_ids, tidy_ids, diff_ids)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(method_ids) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'compare'</span>, <span class="st">'tidy'</span>, <span class="st">'diff'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How many of these dse overlap?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">upset</span>(<span class="fu">fromList</span>(method_ids), <span class="at">nsets =</span> <span class="fu">length</span>(method_ids),</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">text.scale =</span> <span class="fl">1.5</span>, <span class="at">nintersects =</span> <span class="cn">NA</span>, </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mb.ratio =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>), <span class="at">decreasing =</span> <span class="fu">c</span>(T, F),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">main.bar.color =</span> <span class="st">"gray16"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="TAF2OE_AS_analysis_files/figure-html/show%20overlap%20of%20the%20method-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In summary relative to the control sample the 3 different methods:</p>
<ul>
<li><p><em>compare</em> picks up AS events with big ∆PSI differences but could be over stringent.</p></li>
<li><p><em>tidy</em> picks up AS events with small ∆PSI differences but good agreement between replicates.</p></li>
<li><p><em>diff</em> picks up AS events with ∆PSI trends between groups and is less stringent on the accordance between replicates.</p></li>
</ul>
<p>So all in all it kind of makes sense that the overlap between the 3 methods is very small.s</p>
<p>Export a table with the events</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fix a case in which there's no gene name for an event</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>ALL_DSE_WIDE <span class="ot">&lt;-</span> ALL_DSE_WIDE <span class="sc">|&gt;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GENE =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> GENE <span class="sc">==</span> <span class="st">''</span>, <span class="at">yes =</span> <span class="st">'missing_NA'</span>, <span class="at">no =</span> GENE) )</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(<span class="at">x =</span> ALL_DSE_WIDE, </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">file.path</span>(vast_out, <span class="st">'DSE_3methods.tab'</span>), <span class="at">delim =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To check if there are also alternative splice sites events coming from the same region I run this command line in the terminal</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> DSE_3methods.tab <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-k2</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f</span> 2 <span class="kw">|</span> <span class="fu">sed</span> <span class="st">'s/\-[0-9]\/[0-9]$//'</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="at">-c</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-k1</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">awk</span> <span class="st">'{ if ($1 &gt;= 2) print $2}'</span> <span class="op">&gt;</span> DSE_More_1_Method.tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="session-info" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Session Info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.1.2 (2021-11-01)
 os       macOS Catalina 10.15.7
 system   x86_64, darwin17.0
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Madrid
 date     2023-08-03
 pandoc   2.19.2 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 ! package              * version   date (UTC) lib source
   abind                  1.4-5     2016-07-21 [1] CRAN (R 4.1.0)
   ade4                   1.7-22    2023-02-06 [1] CRAN (R 4.1.2)
   annotate               1.72.0    2021-10-26 [1] Bioconductor
   AnnotationDbi          1.56.2    2021-11-09 [1] Bioconductor
   backports              1.4.1     2021-12-13 [1] CRAN (R 4.1.0)
   Biobase                2.54.0    2021-10-26 [1] Bioconductor
   BiocFileCache          2.2.1     2022-01-23 [1] Bioconductor
   BiocGenerics           0.40.0    2021-10-26 [1] Bioconductor
   BiocParallel           1.28.3    2021-12-09 [1] Bioconductor
   biomaRt                2.50.3    2022-02-06 [1] Bioconductor
   Biostrings             2.62.0    2021-10-26 [1] Bioconductor
   bit                    4.0.5     2022-11-15 [1] CRAN (R 4.1.2)
   bit64                  4.0.5     2020-08-30 [1] CRAN (R 4.1.0)
   bitops                 1.0-7     2021-04-24 [1] CRAN (R 4.1.0)
   blob                   1.2.3     2022-04-10 [1] CRAN (R 4.1.2)
   broom                  1.0.4     2023-03-11 [1] CRAN (R 4.1.2)
   cachem                 1.0.7     2023-02-24 [1] CRAN (R 4.1.2)
   Cairo                * 1.6-0     2022-07-05 [1] CRAN (R 4.1.2)
   callr                  3.7.3     2022-11-02 [1] CRAN (R 4.1.2)
   car                    3.1-1     2022-10-19 [1] CRAN (R 4.1.2)
   carData                3.0-5     2022-01-06 [1] CRAN (R 4.1.2)
   cli                    3.6.1     2023-03-23 [1] CRAN (R 4.1.2)
   colorspace             2.1-0     2023-01-23 [1] CRAN (R 4.1.2)
   crayon               * 1.5.2     2022-09-29 [1] CRAN (R 4.1.2)
   csaw                   1.28.0    2021-10-26 [1] Bioconductor
   curl                   5.0.0     2023-01-12 [1] CRAN (R 4.1.2)
   DBI                    1.1.3     2022-06-18 [1] CRAN (R 4.1.2)
   dbplyr                 2.3.1     2023-02-24 [1] CRAN (R 4.1.2)
   DelayedArray           0.20.0    2021-10-26 [1] Bioconductor
   desc                   1.4.2     2022-09-08 [1] CRAN (R 4.1.2)
   DESeq2                 1.34.0    2021-10-26 [1] Bioconductor
   devtools               2.4.5     2022-10-11 [1] CRAN (R 4.1.2)
   digest                 0.6.31    2022-12-11 [1] CRAN (R 4.1.2)
   dplyr                  1.1.1     2023-03-22 [1] CRAN (R 4.1.2)
   edgeR                  3.36.0    2021-10-26 [1] Bioconductor
   ellipsis               0.3.2     2021-04-29 [1] CRAN (R 4.1.0)
   evaluate               0.20      2023-01-17 [1] CRAN (R 4.1.2)
   fansi                  1.0.4     2023-01-22 [1] CRAN (R 4.1.2)
   farver                 2.1.1     2022-07-06 [1] CRAN (R 4.1.2)
   fastmap                1.1.1     2023-02-24 [1] CRAN (R 4.1.2)
   filelock               1.0.2     2018-10-05 [1] CRAN (R 4.1.0)
   forcats                1.0.0     2023-01-29 [1] CRAN (R 4.1.2)
   foreign                0.8-84    2022-12-06 [1] CRAN (R 4.1.2)
   fs                     1.6.1     2023-02-06 [1] CRAN (R 4.1.2)
   genefilter             1.76.0    2021-10-26 [1] Bioconductor
   geneplotter            1.72.0    2021-10-26 [1] Bioconductor
   generics               0.1.3     2022-07-05 [1] CRAN (R 4.1.2)
   GenomeInfoDb           1.30.1    2022-01-30 [1] Bioconductor
   GenomeInfoDbData       1.2.7     2022-02-03 [1] Bioconductor
   GenomicRanges          1.46.1    2021-11-18 [1] Bioconductor
   ggalluvial             0.12.5    2023-02-22 [1] CRAN (R 4.1.2)
   ggfittext              0.9.1     2021-01-30 [1] CRAN (R 4.1.0)
   ggforce              * 0.4.1     2022-10-04 [1] CRAN (R 4.1.2)
   ggplot2              * 3.4.1     2023-02-10 [1] CRAN (R 4.1.2)
   ggrepel              * 0.9.3     2023-02-03 [1] CRAN (R 4.1.2)
   ggseqlogo              0.1       2017-07-25 [1] CRAN (R 4.1.0)
   glue                   1.6.2     2022-02-24 [1] CRAN (R 4.1.2)
   gridExtra              2.3       2017-09-09 [1] CRAN (R 4.1.0)
   gtable                 0.3.3     2023-03-21 [1] CRAN (R 4.1.2)
   hms                    1.1.2     2022-08-19 [1] CRAN (R 4.1.2)
   htmltools              0.5.4     2022-12-07 [1] CRAN (R 4.1.2)
   htmlwidgets            1.6.1     2023-01-07 [1] CRAN (R 4.1.2)
   httpuv                 1.6.9     2023-02-14 [1] CRAN (R 4.1.2)
   httr                   1.4.5     2023-02-24 [1] CRAN (R 4.1.2)
   IRanges                2.28.0    2021-10-26 [1] Bioconductor
   jsonlite               1.8.4     2022-12-06 [1] CRAN (R 4.1.2)
   KEGGREST               1.34.0    2021-10-26 [1] Bioconductor
   knitr                  1.42      2023-01-25 [1] CRAN (R 4.1.2)
   labeling               0.4.2     2020-10-20 [1] CRAN (R 4.1.0)
   later                  1.3.0     2021-08-18 [1] CRAN (R 4.1.0)
   lattice                0.20-45   2021-09-22 [1] CRAN (R 4.1.2)
   lifecycle              1.0.3     2022-10-07 [1] CRAN (R 4.1.2)
   limma                  3.50.3    2022-04-07 [1] Bioconductor
   locfit                 1.5-9.7   2023-01-02 [1] CRAN (R 4.1.2)
   magrittr               2.0.3     2022-03-30 [1] CRAN (R 4.1.2)
   MASS                   7.3-58.3  2023-03-07 [1] CRAN (R 4.1.2)
   Matrix                 1.5-3     2022-11-11 [1] CRAN (R 4.1.2)
   MatrixGenerics         1.6.0     2021-10-26 [1] Bioconductor
   matrixStats            0.63.0    2022-11-18 [1] CRAN (R 4.1.2)
   memoise                2.0.1     2021-11-26 [1] CRAN (R 4.1.0)
   metapod                1.2.0     2021-10-26 [1] Bioconductor
   MetBrewer              0.2.0     2022-03-21 [1] CRAN (R 4.1.2)
   mime                   0.12      2021-09-28 [1] CRAN (R 4.1.0)
   miniUI                 0.1.1.1   2018-05-18 [1] CRAN (R 4.1.0)
   mnormt                 2.1.1     2022-09-26 [1] CRAN (R 4.1.2)
   msa                    1.26.0    2021-10-26 [1] Bioconductor
   munsell                0.5.0     2018-06-12 [1] CRAN (R 4.1.0)
 R niar                 * 0.3.0     &lt;NA&gt;       [?] &lt;NA&gt;
   nlme                   3.1-162   2023-01-31 [1] CRAN (R 4.1.2)
   patchwork            * 1.1.2     2022-08-19 [1] CRAN (R 4.1.2)
   pheatmap             * 1.0.12    2019-01-04 [1] CRAN (R 4.1.0)
   pillar                 1.9.0     2023-03-22 [1] CRAN (R 4.1.2)
   pkgbuild               1.4.0     2022-11-27 [1] CRAN (R 4.1.2)
   pkgconfig              2.0.3     2019-09-22 [1] CRAN (R 4.1.0)
   pkgload                1.3.2     2022-11-16 [1] CRAN (R 4.1.2)
   plyr                   1.8.8     2022-11-11 [1] CRAN (R 4.1.2)
   png                    0.1-8     2022-11-29 [1] CRAN (R 4.1.2)
   polyclip               1.10-4    2022-10-20 [1] CRAN (R 4.1.2)
   prettyunits            1.1.1     2020-01-24 [1] CRAN (R 4.1.0)
   processx               3.8.0     2022-10-26 [1] CRAN (R 4.1.2)
   profvis                0.3.7     2020-11-02 [1] CRAN (R 4.1.0)
   progress               1.2.2     2019-05-16 [1] CRAN (R 4.1.0)
   promises               1.2.0.1   2021-02-11 [1] CRAN (R 4.1.0)
   ps                     1.7.2     2022-10-26 [1] CRAN (R 4.1.2)
   psych                  2.2.9     2022-09-29 [1] CRAN (R 4.1.2)
   psychTools             2.2.9     2022-09-25 [1] CRAN (R 4.1.2)
   purrr                  1.0.1     2023-01-10 [1] CRAN (R 4.1.2)
   R6                     2.5.1     2021-08-19 [1] CRAN (R 4.1.0)
   rappdirs               0.3.3     2021-01-31 [1] CRAN (R 4.1.0)
   RColorBrewer           1.1-3     2022-04-03 [1] CRAN (R 4.1.2)
   Rcpp                   1.0.10    2023-01-22 [1] CRAN (R 4.1.2)
   RCurl                  1.98-1.10 2023-01-27 [1] CRAN (R 4.1.2)
   readr                  2.1.4     2023-02-10 [1] CRAN (R 4.1.2)
   remotes                2.4.2     2021-11-30 [1] CRAN (R 4.1.0)
   rlang                  1.1.0     2023-03-14 [1] CRAN (R 4.1.2)
   rmarkdown              2.20      2023-01-19 [1] CRAN (R 4.1.2)
   rprojroot              2.0.3     2022-04-02 [1] CRAN (R 4.1.2)
   Rsamtools              2.10.0    2021-10-26 [1] Bioconductor
   RSQLite                2.3.0     2023-02-17 [1] CRAN (R 4.1.2)
   rstatix              * 0.7.2     2023-02-01 [1] CRAN (R 4.1.2)
   rstudioapi             0.14      2022-08-22 [1] CRAN (R 4.1.2)
   S4Vectors              0.32.4    2022-03-29 [1] Bioconductor
   scales                 1.2.1     2022-08-20 [1] CRAN (R 4.1.2)
   seqinr                 4.2-23    2022-11-28 [1] CRAN (R 4.1.2)
   sessioninfo            1.2.2     2021-12-06 [1] CRAN (R 4.1.0)
   shiny                  1.7.4     2022-12-15 [1] CRAN (R 4.1.2)
   stringi                1.7.12    2023-01-11 [1] CRAN (R 4.1.2)
   stringr                1.5.0     2022-12-02 [1] CRAN (R 4.1.2)
   SummarizedExperiment   1.24.0    2021-10-26 [1] Bioconductor
   survival               3.5-5     2023-03-12 [1] CRAN (R 4.1.2)
   tibble                 3.2.1     2023-03-20 [1] CRAN (R 4.1.2)
   tidyr                  1.3.0     2023-01-24 [1] CRAN (R 4.1.2)
   tidyselect             1.2.0     2022-10-10 [1] CRAN (R 4.1.2)
   tweenr                 2.0.2     2022-09-06 [1] CRAN (R 4.1.2)
   tzdb                   0.3.0     2022-03-28 [1] CRAN (R 4.1.2)
   UpSetR               * 1.4.0     2019-05-22 [1] CRAN (R 4.1.0)
   urlchecker             1.0.1     2021-11-30 [1] CRAN (R 4.1.0)
   usethis                2.1.6     2022-05-25 [1] CRAN (R 4.1.2)
   utf8                   1.2.3     2023-01-31 [1] CRAN (R 4.1.2)
   vctrs                  0.6.1     2023-03-22 [1] CRAN (R 4.1.2)
   viridis              * 0.6.2     2021-10-13 [1] CRAN (R 4.1.0)
   viridisLite          * 0.4.1     2022-08-22 [1] CRAN (R 4.1.2)
   vroom                  1.6.1     2023-01-22 [1] CRAN (R 4.1.2)
   withr                  2.5.0     2022-03-03 [1] CRAN (R 4.1.2)
   xfun                   0.37      2023-01-31 [1] CRAN (R 4.1.2)
   XICOR                  0.4.1     2023-04-21 [1] CRAN (R 4.1.2)
   XML                    3.99-0.13 2022-12-04 [1] CRAN (R 4.1.2)
   xml2                   1.3.3     2021-11-30 [1] CRAN (R 4.1.0)
   xtable                 1.8-4     2019-04-21 [1] CRAN (R 4.1.0)
   XVector                0.34.0    2021-10-26 [1] Bioconductor
   yaml                   2.3.7     2023-01-23 [1] CRAN (R 4.1.2)
   zlibbioc               1.40.0    2021-10-26 [1] Bioconductor

 [1] /Library/Frameworks/R.framework/Versions/4.1/Resources/library

 R ── Package was removed from disk.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Han2017a" class="csl-entry" role="doc-biblioentry">
Han, Hong, Ulrich Braunschweig, Thomas Gonatopoulos-Pournatzis, Robert J. Weatheritt, Calley L. Hirsch, Kevin C H Ha, Ernest Radovani, et al. 2017. <span>“<span class="nocase">Multilayered Control of Alternative Splicing Regulatory Networks by Transcription Factors.</span>”</span> <em>Molecular Cell</em> 65 (3): 539–553.e7. <a href="https://doi.org/10.1016/j.molcel.2017.01.011">https://doi.org/10.1016/j.molcel.2017.01.011</a>.
</div>
<div id="ref-Tapial2017" class="csl-entry" role="doc-biblioentry">
Tapial, Javier, Kevin C. H. Ha, Timothy Sterne-Weiler, André Gohr, Ulrich Braunschweig, Antonio Hermoso-Pulido, Mathieu Quesnel-Vallières, et al. 2017. <span>“<span class="nocase">An atlas of alternative splicing profiles and functional associations reveals new regulatory programs and genes that simultaneously express multiple major isoforms</span>.”</span> <em>Genome Research</em> 27 (10): 1759–68. <a href="https://doi.org/10.1101/gr.220962.117">https://doi.org/10.1101/gr.220962.117</a>.
</div>
<div id="ref-Weatheritt2016" class="csl-entry" role="doc-biblioentry">
Weatheritt, Robert J, Timothy Sterne-Weiler, and Benjamin J Blencowe. 2016. <span>“<span class="nocase">The ribosome-engaged landscape of alternative splicing</span>.”</span> <em>Nature Structural &amp; Molecular Biology</em> 23 (12): 1117–23. <a href="https://doi.org/10.1038/nsmb.3317">https://doi.org/10.1038/nsmb.3317</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>